var tableOptions={theme:"blue",widgets:["filter"],widgetOptions:{filter_searchDelay:300,filter_columnFilters:!1,filter_selectSource:{2:function(table,column,onlyAvail){var groups=[],tds;return $(table).find("tbody tr").find("td:eq("+column+")").find("span.std-dashboard-group").each((function(i,gn){groups.push($(this).text())})),groups.filter((function(a){if(!this[a])return this[a]=1,a}),{})}}},dateFormat:"j M Y",textExtraction:function(node,table,columnIndex){if(0===columnIndex)return $(node).data("subject");if(3===columnIndex)return $(node).closest("tr").attr("data-type");var val=$(node).attr("data-sort-value");return void 0!==val&&!1!==val?val:$(node).text()}};function set_notification_dropdown_height(){$("#new-notifications").find("ul.dropdown-menu").css({"max-height":.6*$(window).height()+"px"})}function loadMoreNotifications(nPage,stdId){var url="pages/std/std-dashboard.php?action=load-more-notifications",data={ticket:$("#ticket").val(),student_id:stdId,"n-page":nPage},dates=["TODAY","YESTERDAY","OLDER"];$.post(url,data,(function(response){if(1==response.success){var nextNotifications=response.notifications,currentPage=response.page,totalPages=response.total,list=$("#new-notifications");$.each(dates,(function(i,date){var heading;list.find('h6:contains("'+date+'")').length&&(nextNotifications=nextNotifications.replace("<h6>"+date+"</h6>",""))})),$(nextNotifications).insertAfter(list.find("ul > li.notification").last());var unread=list.find("ul > li.notification.selected");unread.length&&(list.find("span.unread-msgs").show().text(unread.length),list.find("a.mark-all-as-read").removeClass("disabled")),currentPage<totalPages?$("#load-more-notifications").data("n-page",response.page).attr("data-n-page",response.page):$("#load-more-notifications").replaceWith("No more notifications to show in the last 30 days")}}),"json")}function toggleNotificationRead(listItem,target=null){var notifications=$("#new-notifications"),toggler=listItem.find("a.mark-as-read"),isRead=!0,openTask=!0;null==target||target.hasClass("task-link")||(isRead=toggler.hasClass("selected"),openTask=!1);var url="pages/std/std-dashboard.php?action=toggle-notification-read",data={ticket:$("#ticket").val(),notification_id:listItem.data("id"),is_read:isRead};$.post(url,data,(function(response){if(1==response.success){var read=response.read;listItem.toggleClass("selected",!read),toggler.prop("title","Mark as "+(read?"unread":"read")),toggler.toggleClass("selected",!read),toggler.find("i").toggleClass("fa-circle-o",read).toggleClass("fa-check-circle-o",!read);var nUnread=notifications.find("a.mark-as-read.selected").length;if(notifications.find("a.mark-all-as-read").toggleClass("disabled",nUnread<=0),notifications.find("span.unread-msgs").toggle(nUnread>0).text(nUnread),null!=target&&openTask){var link=listItem.find("a.task-link").attr("href");window.location.href=link}}else alert(response.msg)}),"json")}function markAllNotificationsAsRead(){var notifications=[];if($("#new-notifications").find("a.mark-as-read.selected").each((function(){var unreadLi=$(this).closest("li");notifications.push(unreadLi.data("id"))})),!notifications.length)return!1;var url="pages/std/std-dashboard.php?action=mark-all-as-read",data={ticket:$("#ticket").val(),notifications:notifications};$.post(url,data,(function(response){if(1==response.success){var nContainer=$("#new-notifications");nContainer.find("a.mark-as-read.selected").each((function(){$(this).removeClass("selected"),$(this).find("i").toggleClass("fa-circle-o fa-check-circle-o")})),nContainer.find("li.notification").removeClass("selected"),nContainer.find("a.mark-all-as-read").addClass("disabled"),nContainer.find("span.unread-msgs").hide()}else alert(response.msg)}),"json")}function loadAllStudentTasks(studentId){$("#tasks-loading").show(),$.post("pages/std/std-dashboard.php?action=get-all-tasks",{ticket:$("#ticket").val(),student_id:studentId},(function(response){if(1==response.success){if(0==response.hasTasks)$("#tasks-anchors").hide();else{var navElements=[];null!=response["std-active-html"]&&navElements.push("active"),null!=response["std-overdue-html"]&&navElements.push("overdue"),response["std-completed-html"]&&navElements.push("completed"),navElementsToHTML(navElements)}$.when(putTablesInPlace(response)).then(sortTaskTables(),update_local_dates($("#main-column")))}}),"json")}function putTablesInPlace(response){$("#tasks-loading").hide(),$("#std-tasks-table-active").html(response["std-active-html"]),$("#std-tasks-table-overdue").html(response["std-overdue-html"]),$("#std-tasks-table-completed").html(response["std-completed-html"]),response.hasCompletedTasks>0?$("select.task-completed-date, .task-type-filter").show():$("select.task-completed-date, .task-type-filter").hide(),0==response.hasExamTasks?$(".bg-exam").parent("div").hide():$(".bg-exam").parent("div").show(),renderNotRequired(response["std-notrequired-html"])}function renderNotRequired(htmlcontent){""!=htmlcontent&&($("#std-tasks-table-notrequired").html(htmlcontent),$("#tasks-notrequired").show())}function sortTaskTables(){tableOptions.headers={3:{sorter:"shortDate"},4:{sorter:!1}},tableOptions.sortList=[[3,1]],initializeStdTasksTablesorter($("#std-tasks-table-active table"),".pager-tasks-active",tableOptions),initializeStdTasksTablesorter($("#std-tasks-table-overdue table"),".pager-tasks-overdue",tableOptions),initializeStdTasksTablesorter($("#std-tasks-table-notrequired table"),".pager-tasks-notrequired",tableOptions),tableOptions.headers={3:{sorter:!1},4:{sorter:"shortDate"},5:{sorter:"shortDate"},6:{sorter:!1}},tableOptions.sortList=[[4,1]],initializeStdTasksTablesorter($("#std-tasks-table-completed table"),".pager-tasks-completed",tableOptions)}function initializeStdTasksTablesorter(table,status,tablesorterOptions){$.when($.tablesorter.customPagerControls({table:table,pager:status,pageSize:".left a",currentPage:".right li",link:'<li><a href="#" data-page="{page}">{page}</a></li>',distanceSpacer:"",adjacentSpacer:""})).then(table.on("filterEnd",(function(e,table){var c=this.config,filtered=c.filteredRows;c.$table.find(".noData").remove(),0===filtered&&c.$table.append(['<tr class="noData remove-me" role="alert" aria-live="assertive">','<td colspan="'+c.columns+'" class="no-tasks-block">No results found</td>',"</tr>"].join(""))})),table.tablesorter(tablesorterOptions).tablesorterPager(getStdTaskPagerOptions(status)),table.trigger("pageSize",10))}function getStdTaskPagerOptions(taskStatus,pager){return pagerOptions={container:$(taskStatus),cssPageSize:".pagesize",cssPageDisplay:".pagedisplay",page:0,size:10,output:function(table,pager){return $(taskStatus).closest(".std-tasks").toggle(pager.filteredRows>0),$(taskStatus).filter(".std-pager-footer").toggle(pager.filteredRows>=10),"("+pager.filteredRows+")"}}}function filterAllStudentTasks(element){element.on("click","ul.filter-task-type > li > a",(function(e){e.preventDefault();var type=$(this).data("type");"all"!=type?$(this).closest(".dropdown").children("a").html($(this).html()+' <b class="caret"></b>'):$(this).closest(".dropdown").children("a").html('Filter by task type <b class="caret"></b>'),$(this).closest("div.filter-task-type").attr("data-current-type",type),$(this).closest("div.filter-task-type").data("current-type",type),filterByTaskType(type)})),element.on("click","ul.filter-task-subject > li > a",(function(e){e.preventDefault();var subject=$(this).data("subject");"all"!=subject?$(this).closest(".dropdown").children("a").html($(this).html()+' <b class="caret"></b>'):$(this).closest(".dropdown").children("a").html('Filter by subject <b class="caret"></b>'),$(this).closest("div.filter-task-subject").attr("data-current-subject",subject),$(this).closest("div.filter-task-subject").data("current-subject",subject),filterByStdSubject(subject)})),element.on("keydown","input.filter-task-title",(function(e){var search;13===e.which&&(e.preventDefault(),filterBySearchTask($(this).val()))})),element.on("click","button.search-task-title",(function(e){var search;e.preventDefault(),filterBySearchTask($(this).prev("input.filter-task-title").val())})),element.on("click","button.filters-reset",(function(e){e.preventDefault();var taskType=$("div.filter-task-type");taskType.attr("data-current-type","all").data("current-type","all"),taskType.children("a").html('Filter by task type <b class="caret"></b>');var taskSubject=$("div.filter-task-subject");taskSubject.attr("data-current-subject","all").data("current-subject","all"),taskSubject.children("a").html('Filter by subject <b class="caret"></b>'),$("input.filter-task-title").val(""),$("table.task-table").each((function(i,table){$(table).trigger("filterReset")}))}))}function filterBySearchTask(search){var filters=[],txt=search,tables=$("table.task-table"),currentType=$("div.filter-task-type").data("current-type"),currentSubject=$("div.filter-task-subject").data("current-subject");if("all"!=currentSubject&&(filters[0]=currentSubject),""!=txt.trim()&&(filters[1]=txt),"all"!=currentType&&(filters[3]=currentType),""==txt.trim()&&"all"==currentType&&"all"==currentSubject)return tables.each((function(i,table){$(table).trigger("filterReset")})),!1;tables.each((function(i,table){$.tablesorter.setFilters(table,filters,!0)}))}function filterByTaskType(type){var filters=[],txt=type,tables=$("table.task-table"),currentSearch=$("input.filter-task-title").val(),currentSubject=$("div.filter-task-subject").data("current-subject");if("all"!=currentSubject&&(filters[0]=currentSubject),""!=currentSearch.trim()&&(filters[1]=currentSearch),"all"!=txt&&(filters[3]=txt),"all"==txt&&""==currentSearch&&"all"==currentSubject)return tables.each((function(i,table){$(table).trigger("filterReset")})),!1;tables.each((function(i,table){$.tablesorter.setFilters(table,filters,!0)}))}function filterByStdSubject(subject){var filters=[],txt=subject,tables=$("table.task-table"),currentSearch=$("input.filter-task-title").val(),currentType=$("div.filter-task-type").data("current-type");if("all"!=txt&&(filters[0]=txt),""!=currentSearch.trim()&&(filters[1]=currentSearch),"all"!=currentType&&(filters[3]=currentType),"all"==txt&&""==currentSearch&&"all"==currentType)return tables.each((function(i,table){$(table).trigger("filterReset")})),!1;tables.each((function(i,table){$.tablesorter.setFilters(table,filters,!0)}))}function navElementsToHTML(navElements){for(var resultString="Check your ",i=0;i<navElements.length;i++)currentElement=navElements[i],i+1==navElements.length&&navElements.length>1&&(resultString+=" and "),resultString+='<a href="#std-tasks-table-'+currentElement+'">'+currentElement+"</a>",i+1!=navElements.length&&i+2!=navElements.length&&navElements.length>2&&(resultString+=", ");resultString+=" tasks.",$("#tasks-anchors > p").html(resultString),$("a[href='#std-tasks-table-active'], a[href='#std-tasks-table-overdue'], a[href='#std-tasks-table-completed'],  a[href='#std-tasks-table-notrequired']").click((function(e){e.preventDefault();var position=$($(this).attr("href")).offset().top-2;$("body, html").animate({scrollTop:position},"fast")}))}$(document).ready((function(){if(update_local_dates($("#main-column")),orderingPendingTasks("order-pending-tasks","assignments-list"),$(".group").click((function(){var url=$(this).data("url");window.location=url})),$("#subjects-assignments-switcher > a").click((function(){$("#subjects-assignments-switcher > a").toggleClass("active")})),"undefined"!=typeof Storage&&!localStorage.hasOwnProperty("exams")){var deadline=new Date("2019-05-01"),currentd=new Date;if(currentd<deadline){var alert=$("<div />",{class:"modal hide fade"});alert.html('<div class="modal-header"><button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button><h2 style="margin: 0">The May IB exams are coming!</h2></div><div class="modal-body" style="font-size: 1.4em; line-height: 2em"><p>Improve your grades by signing up now to <a href="//studyib.net">www.StudyIB.net</a> where you will find masses of FREE review materials.',"</div>"),$("body").append(alert),alert.modal("show"),localStorage.setItem("exams",currentd)}}set_notification_dropdown_height(),loadAllStudentTasks(studentId),filterAllStudentTasks($("#content")),setShowResultsListeners($("#content")),addMarksThreads($("#modal-std-write")),$("a").closest("td.exam").on("click",(function(){if($(this).find(".running").length)return!0})),$("#content").on("click","a.dashboard-section",(function(){$(this).find("i.fa-caret-down").toggleClass("fa-rotate-270")})),$("#new-notifications").on("click","ul.dropdown-menu",(function(e){$(e.target).is("a, i")||(e.preventDefault(),e.stopPropagation())})),$("#new-notifications").on("click","a.mark-as-read, a.task-link",(function(e){e.preventDefault(),e.stopPropagation(),toggleNotificationRead($(this).closest("li"),$(e.target))})),$("#new-notifications").on("click","a.mark-all-as-read",(function(e){if(e.preventDefault(),e.stopPropagation(),$(this).hasClass("disabled"))return!1;markAllNotificationsAsRead()})),$("#new-notifications").on("click","#load-more-notifications",(function(e){var nPage;e.preventDefault(),e.stopPropagation(),loadMoreNotifications($(this).data("n-page"),studentId)}))}));