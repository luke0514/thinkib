var doLoadStudentReport=!1,doLoadTask=!1,studentReportData=[],gradeSent=!1,taskType="",hasInitializedTasks=!1,assignmentsNavigationItems=[],reloadLocation=!1,stdList=[],stdCompletedList=[],currentStd=null,hasCustomDeadline=!1;function initTasksList(mode,id){$("input.filter-task-title").keydown((function(e){if(13===e.which){e.preventDefault();var status=$(this).data("status");filterTasks(mode,id,status)}})),$("button.search-task-title").click((function(e){e.preventDefault();var status=$(this).data("status");filterTasks(mode,id,status)})),$("select.filter-recipients").on("change",(function(e){var status=$(this).data("status");filterTasks(mode,id,status)})),$("ul.filter-task-type > li > a").click((function(e){e.preventDefault();var type=$(this).data("type"),status=$(this).closest("ul").data("status");$('input.filter-task-type[data-status="'+status+'"]').val(type),"all"!=type?$(this).closest(".dropdown").children("a").html($(this).html()+' <b class="caret"></b>'):$(this).closest(".dropdown").children("a").html('Filter by task type <b class="caret"></b>'),filterTasks(mode,id,status)})),$("ul.filter-group > li > a").click((function(e){e.preventDefault();var groupId=$(this).data("id"),status=$(this).closest("ul").data("status");$("input.filter-group").val(groupId),"0"==groupId?$(this).closest(".dropdown").children("a").html('Filter by group <b class="caret"></b>'):$(this).closest(".dropdown").children("a").html($(this).html()+' <b class="caret"></b>'),filterTasks(mode,id,status)})),$("button.filters-reset").click((function(e){e.preventDefault();var status=$(this).data("status");resetTasksFilter(status),filterTasks(mode,id,status)})),$("#active-assignments-container, #pending-assignments-container, #overdue-assignments-container, #awaiting-assignments-container,\n       #completed-assignments-container, #forgiven-assignments-container").on("click","table > thead > tr > th.header",(function(e){e.preventDefault();var status=$(this).parents("table").data("status"),sortkey=$(this).attr("rel"),sortmode=$(this).hasClass("headerSortDown")?"desc":"asc";$("#"+status+"-sortkey").val(sortkey),$("#"+status+"-sortmode").val(sortmode),$("#"+status+"-page").val(1),loadTasksList(mode,id,[status])})),$("#active-assignments-container, #pending-assignments-container, #overdue-assignments-container, #awaiting-assignments-container,\n       #completed-assignments-container").on("click","a.delete-task",(function(e){e.preventDefault();var row=$(this).closest("tr"),status=row.data("status"),task=row.data("task"),combined_task_id=row.data("combined-task-id");if(confirm("Please confirm you want to delete this task completely")){var page="pages/std-access/std-assignments.php?action=";page+="pending"==status?"delete-pending-task":"delete-task";var data={ticket:$("#ticket").val(),task:task,combined_task_id:combined_task_id,general_id:$("#general-id").val()};$.post(page,data,(function(response){1==response.success?refreshTasksList(mode,id,[status]):alert(response.msg)}),"json")}})),$(".task-pager-container").on("click","nav.left select > option",(function(e){e.preventDefault();var status=$(this).parents("div.task-pager-container").data("status"),offset=$(this).val();$("#"+status+"-page").val(1),$("#"+status+"-offset").val(offset),loadTasksList(mode,id,[status])})),$(".task-pager-container").on("click","nav.pagination li > a",(function(e){e.preventDefault();var status=$(this).parents("div.task-pager-container").data("status"),page=$(this).data("page");$("#"+status+"-page").val(page),loadTasksList(mode,id,[status])})),$(".task-pager-container").on("click","nav.pagination li > span.prev",(function(e){e.preventDefault();var status=$(this).parents("div.task-pager-container").data("status"),page,goTo=parseInt($("#"+status+"-page").val())-1;goTo>0&&($("#"+status+"-page").val(goTo),loadTasksList(mode,id,[status]))})),$(".task-pager-container").on("click","nav.pagination li > span.next",(function(e){e.preventDefault();var pagerCTN=$(this).parents("div.task-pager-container"),status=pagerCTN.data("status"),page,goTo=parseInt($("#"+status+"-page").val())+1;1==pagerCTN.find('ul > li > a[data-page="'+goTo+'"]').length&&($("#"+status+"-page").val(goTo),loadTasksList(mode,id,[status]))})),hasInitializedTasks=!0}function loadTasksList(mode,id=null,queue=["active","pending","overdue","awaiting","completed"]){if(queue.length>0){hasInitializedTasks||initTasksList(mode,id);var reportTaskId=null;studentReportData.length>0&&(reportTaskId=studentReportData[0]);var status=queue[0],data={ticket:$("#ticket").val(),general_id:$("#general-id").val(),mode:mode,status:status,report_task_id:reportTaskId,offset:$("#"+status+"-offset").val(),page:$("#"+status+"-page").val(),sortkey:$("#"+status+"-sortkey").val(),sortmode:$("#"+status+"-sortmode").val()},filterMode=status;"all"==$(".task-filter-fields").data("status")&&(filterMode="all");var f_task_title=$('input.filter-task-title[data-status="'+filterMode+'"]'),f_recipients=$('input.filter-group[data-status="'+filterMode+'"]'),f_task_type=$('input.filter-task-type[data-status="'+filterMode+'"]');switch(1==f_task_title.length&&(data.f_task_title=f_task_title.val()),1==f_recipients.length&&(data.f_recipients="-1"==f_recipients.val()?"students":f_recipients.val()),1==f_task_type.length&&(data.f_task_type=f_task_type.val()),mode){case"group":data["group-id"]=id;break;case"student":data["std-id"]=id}var status_table=$("#"+status+"-assignments-container").find("table.tablesorter");1==status_table.length&&(status_table.find("tbody").css("opacity",".4"),status_table.css("background-image",'url("css/art/loading-snake-128.gif")'),status_table.css("background-position","50% 30px"),status_table.css("background-repeat","no-repeat"));var page="pages/std-access/std-task-loader.php?action=get-assignments";$.post(page,data,(function(response){var topCTN=$('div.task-top-container[data-status="'+status+'"]'),pagerCTN=$('div.task-pager-container[data-status="'+status+'"]'),pagerINFO=$('div.task-pager-info[data-status="'+status+'"]'),tasksCTN=$("#"+status+"-assignments-container"),filterCTN=$("div.task-filter-fields");if("1"==response.success){var nOffset=parseInt(response.offset),nPage=parseInt(response.page),nPages=parseInt(response.pages),nRows=parseInt(response.n_rows),filtered=response.filtered,sortkey=response.sort_key,sortmode=response.sort_mode,show_report=response.show_report;if(addAssignmentPendingItem({name:status,count:response.n_rows}),filterCTN.show(),topCTN.show(),pagerINFO.html(response.pager_info),tasksCTN.html(response.html),nRows<=10?pagerCTN.hide():loadTaskPager(pagerCTN,nOffset,nPage,nPages,nRows),filtered||updateTotalRows(mode,status,nRows),""!=sortkey&&""!=sortmode){var th=$("#"+status+"-assignments-container table."+status+" > thead > tr > th[rel='"+sortkey+"']");1==th.length&&th.addClass("asc"==sortmode?"headerSortDown":"headerSortUp")}update_local_dates(tasksCTN),1==show_report&&doShowReport(),"all"==filterMode&&($('div.task-top-container[data-status="'+status+'"]').find(".total").html("("+nRows+")"),$('.task-pager-info[data-status="'+status+'"]').hide(),0==nRows&&($('div.task-top-container[data-status="'+status+'"]').hide(),$('table[data-status="'+status+'"]').hide()))}else"0"==response.success&&alert(response.msg);if(queue.length>1)for(var i=1;i<queue.length;i++)loadTasksList(mode,id,[queue[i]],resetFilters)}),"json")}}function loadTaskPager(pagerCTN,nOffset,nPage,nPages,nRows){for(var offset_opts=[10,25,50,100],offset_html=[],i=0;i<offset_opts.length;i++){var disabled="",selected="";if(offset_opts[i]==nOffset&&(disabled=" disabled",selected=" selected"),offset_html.push('<option value="'+offset_opts[i]+'"'+disabled+" "+selected+">"+offset_opts[i]+"</option>"),nRows<=offset_opts[i])break}pagerCTN.find("nav.left").html(`\n        <label> Show\n            <select style="width: auto;">\n                ${offset_html}\n            </select> entries\n        </label>\n    `);for(var pages_html=[],i=1;i<=nPages;i++)pages_html.push('<li><a href="#" data-page="'+i+'">'+i+"</a></li>");if(nPages>10){for(;pages_html.length>10;){var half=parseInt(pages_html.length/2);pages_html.splice(half,1)}pages_html.splice(5,0,'<li><a href="#">...</a></li>')}pagerCTN.find("nav.right span.pagecount").length?pagerCTN.find("nav.right span.pagecount").replaceWith(pages_html.join(" ")):(pagerCTN.find("nav.right ul").remove(),pagerCTN.find("nav.right").html(`\n            <ul>\n                <li><span class="prev" title="Prev"><i class="fa fa-chevron-left"></i></span></li>\n                ${pages_html.join(" ")}\n                <li><span class="next" title="Next"><i class="fa fa-chevron-right"></i></span></li>\n            </ul>\n        `)),pagerCTN.find("nav.right li").removeClass("active"),pagerCTN.find('nav.right li > a[data-page="'+nPage+'"]').parent("li").addClass("active"),pagerCTN.show()}function filterTasks(mode,id,status){var statusArray=[],stdFilters,generalFilters;"all"==status?(statusArray="student"==mode?["active","overdue","awaiting","completed","forgiven"]:["active","pending","overdue","awaiting","completed"],$.each(statusArray,(function(i,s){$("#"+s+"-page").val(1)}))):(statusArray.push(status),$("#"+status+"-page").val(1));loadTasksList(mode,id,statusArray)}function resetTasksFilter(status){var f_task_title=$('input.filter-task-title[data-status="'+status+'"]'),f_recipients=$('input.filter-group[data-status="'+status+'"]'),f_task_type=$('input.filter-task-type[data-status="'+status+'"]');1==f_task_title.length&&f_task_title.val(""),1==f_recipients.length&&(f_recipients.val(0),f_recipients.closest(".dropdown").children("a").html('Filter by group <b class="caret"></b>')),1==f_task_type.length&&(f_task_type.val("all"),f_task_type.closest(".dropdown").children("a").html('Filter by task type <b class="caret"></b>'))}function refreshTasksList(mode,id,statusList=["active","pending","overdue","awaiting","completed"]){if(statusList.length>0){for(var i=0;i<statusList.length;i++)resetTasksFilter(statusList[i]),$("#"+statusList[i]+"-page").val(1);loadTasksList(mode,id,statusList)}}function updateTotalRows(mode,status,nRows){switch(mode){case"general":$('.nav-pills a[href="#'+status+'-tab"]').find("span.total").text(nRows>0?"("+nRows+")":"");break;case"student":case"group":$('div.task-top-container[data-status="'+status+'"]').find(".total").html("("+nRows+")")}}function sendDraft(){$("#pending-assignments-container").on("click",".send-task",(function(e){if(e.preventDefault(),$(this).hasClass("not-allowed"))return!1;var taskId=$(this).closest("tr").data("task"),combinedTaskId=$(this).closest("tr").data("combined-task-id"),groupId=null,mode="general";$("#group-id").length>0&&(groupId=$("#group-id").val(),mode="group"),deliverTask(mode,groupId,taskId,combinedTaskId)}))}function deliverTask(mode,groupId,taskId,combinedTaskId=""){var page="pages/std-access/std-assignments.php?action=deliver-tasks",data={ticket:$("#ticket").val(),tasks:taskId,combined_task_id:combinedTaskId,general_id:$("#general-id").val(),sitename:$("#sitename").val()};$.post(page,data,(function(response){1==response.success?($(".std-assignment-send-msg").html(['<div class="alert alert-success" style="margin-bottom: 10px; margin-top: 10px;">','<i class="fa fa-check-circle-o"></i> ',"<strong>Task successfully sent to your students.</strong>","</div>"].join("")).show("fast").delay(5e3).hide("slow"),refreshTasksList(mode,groupId,["pending","active"])):alert(response.msg)}),"json")}function doShowReport(){var taskId=studentReportData[0],tr;(switchToRelevantTab(taskId),doLoadTask||doLoadStudentReport)&&($("#main-column .tab-content").find("#task-"+taskId).find("a.load-report").trigger("click"),$(".task-filter-fields").hide("fast"),doLoadTask&&(doLoadTask=!1,studentReportData=[]))}function switchToRelevantTab(taskId){var status=$("#task-"+taskId).find("a.load-report").parents("table").data("status"),tr;$('a[href="#'+status+'-tab"]').tab("show"),$("#main-column .tab-content").find("#task-"+taskId).addClass("warning")}function checkAndGoToStage5(button){if($("#resources-container").find('td.data[data-type="write"]').length&&+$(".min-words").val()>+$(".max-words").val()&&$("#max-words").val()>0)return alert("The minimum number of words can not exceed the maximum number"),!1;if(button.hasClass("disabled"))return alert(button.data("alert")),!1;var hasMissingDate=!1;if($("#resources-container").find("td.data input.set-date").each((function(){if(""==$(this).val())return hasMissingDate=!0,!1})),hasMissingDate)return alert("You must select a deadline for every task"),!1;$.when(resetSummary()).then(createSummary()),$.when(gotoStage(5)).then(setWizardMultistepStage(5))}function resetSummary(){$("#summary-tasks").empty(),$("#summary-deadline").text("Not set"),$("#summary-recipients").empty()}function createSummary(){var summaryDeadline=$("#deadline-date").val();$("#summary-deadline").text(summaryDeadline),hasCustomDeadline=!1,$("#resources-container").find("td.data input.set-date").each((function(){var customDeadline=$(this).val();summaryDeadline!=customDeadline&&(hasCustomDeadline=!0)})),$("#resources-container").find("td.data").each((function(){var icon=$(this).find("span.icon").html(),name="",notes="",combinedTaskRequired="",examMode="",examMinutes="",type_task=$(this).data("type"),deadline=$(this).find("input.set-date").val(),scoreAnswersMode="",checked;switch(type_task){case"write":var min=""==$("#min-words").val()?$(this).find(".words").data("min"):$("#min-words").val(),max=""==$("#max-words").val()?0:$("#max-words").val(),minmax=null!=min&&null!=max?`(${min} - ${max} words)`:"";""!=minmax&&(minmax=0==max?`(Minimum ${min} words)`:`(${min} - ${max} words)`),""!=(notes=""==$("#instructions").val()?$(this).find(".instructions").text():$("#instructions").val())?(notes+=`<br />${minmax}`,name=$(this).find("strong.title").text()):name=`${$(this).find("strong.title").text()} ${minmax}`,examMinutes=$(this).find(".exam_mode_minutes").val(),$.isNumeric(examMinutes)&&(examMode="<strong>Exam mode:</strong> "+examMinutes+" minutes"),$("#instructions").val($(this).find(".instructions").val()),$("#min-words").val(min),$("#max-words").val(max);break;case"discussion":name=$(this).find("strong.title").text(),notes=""==$("#discussion-description").val()?$(this).find(".discussion").text():$("#discussion-description").val();break;case"quiz":case"quiz-page":case"short-answer":notes=$("#global-in-page-instructions").val().length>0?$("#global-in-page-instructions").val():$(this).children(".instructions").val(),name=$(this).find("strong.title").text(),examMinutes=$(this).find(".exam_mode_minutes").val(),$.isNumeric(examMinutes)&&(examMode="<strong>Exam mode:</strong> "+examMinutes+" minutes"),"quiz-page"!=$(this).data("type")||$(this).find(".task-required > input").is(":checked")||($(this).data("type","read"),icon='<span class="icon"><i class="fa fixwidth colored fa-file"></i>&nbsp;</span>');break;case"read":case"in-page-combined-task":notes=$("#global-in-page-instructions").val().length>0?$("#global-in-page-instructions").val():$(this).find(".instructions").val(),name=$(this).find("strong.title").text(),$(this).find(".combined-task-required > input").each((function(){$(this).is(":checked")&&($(this).attr("checked","true"),$(this).prop("disabled",!0),combinedTaskRequired+=$(this).parent()[0].outerHTML,$(this).prop("disabled",!1))})),examMinutes=$(this).find(".exam_mode_minutes").val(),$.isNumeric(examMinutes)&&(examMode="<strong>Exam mode:</strong> "+examMinutes+" minutes");break;case"written-answer":case"model-answer":notes=$(this).children(".instructions").val(),name=$(this).find("strong.title").text();break;default:alert("There was an error loading the summary, please contact suport")}$(this).find(".score-answers-container").length&&(scoreAnswersMode=getScoreAnswersMode($(this).find('.score-answers-container input[type="radio"]:checked').data("opt"),type_task));""!=scoreAnswersMode&&(scoreAnswersMode='<br /><small style="margin-left: 2.2em;">'+scoreAnswersMode+"</small>");var appendNotes=""==notes?"":["<tr>",'<td style="width: 10px;"><i>Instructions:</i></td>','<td style="padding: 10px">',`<small><em>${notes}</em></small>`,"</td>","</tr>"].join(""),examModeNotes=""==examMode?"":`<br /><small style="margin-left: 2.2em;">${examMode}</small>`;hasCustomDeadline?($("#summary-deadline").prev("span.deadline").html('<i class="fa fa-fw fa-calendar-check-o"></i>Deadlines'),$("#summary-deadline").hide()):($("#summary-deadline").prev("span.deadline").html('<i class="fa fa-fw fa-calendar-check-o"></i>Deadline:'),$("#summary-deadline").show());var deadlineHtml,appendCombinedTaskRequired,h=["<tr>",`<th colspan="2">\n                    ${icon} ${name} ${examModeNotes} ${scoreAnswersMode} ${hasCustomDeadline?['<span class="gray pull-right">',`<span class="custom-deadline">${deadline}</span>`,"</span>"].join(""):""}\n                </th>`,"</tr>",""==combinedTaskRequired?"":["<tr>",'<td style="padding: 10px"  colspan="2" >',combinedTaskRequired,"</td>","</tr>"].join("")].join("");$("#summary-tasks").append(h)})),$("#modal-assignment-wizard .groups-container").find('input[type="checkbox"]:checked').length>0?$("#modal-assignment-wizard .groups-container").find('input[type="checkbox"]:checked').each((function(){var groupId=$(this).val(),groupName=$(this).parent("label").text(),studentSelectors=$("#modal-assignment-wizard .students-container").find("input.group-"+groupId),studentsSelected=0;studentSelectors.each((function(){$(this).parent().hasClass("selected")&&studentsSelected++})),studentsSelected>0&&(groupName=groupName.replace(/\(Students:\s*[0-9]*\)/gim,"(Students: "+studentsSelected+")")),$("#summary-recipients").append("<li>"+groupName+"</li>")})):$("#modal-assignment-wizard .students-container").find('input[type="checkbox"]:checked').length>0&&$("#modal-assignment-wizard .students-container").find('input[type="checkbox"]:checked').each((function(){$("#summary-recipients").append("<li>"+$(this).parent("label").text()+"</li>")}))}function getScoreAnswersMode(checked,task_type){var mode="";return"1"==checked?mode="short-answer"==task_type?"<strong>Submit option:</strong> Students see answers after the deadline":"<strong>Submit option:</strong> Students see score on completion of the task and answers after the deadline":"2"==checked&&(mode="<strong>Submit option:</strong> Students see score and answers after the deadline"),mode}function updateStage2Btn(mode){if($('#tree-read-selector input[type="checkbox"]').is(":checked")||$('#tree-site-page-selector input[type="checkbox"]').is(":checked")||$('#qbank-checks input[type="checkbox"]').is(":checked")||$('#editor-qbank-checks input[type="checkbox"]').is(":checked")){if(""!=$("#discussion-title").val()?$("#discussion-tab-link").find("span.basket-counter").text("(1)"):$("#discussion-tab-link").find("span.basket-counter").text(""),""!=$("#writeTitle").val()){if(+$("#min-words").val()>+$("#max-words").val()&&$("#max-words").val()>0)return $("#to-stage-2").data("alert","The minimum number of words can not exceed the maximum number"),$("#write-tab-link").find("span.basket-counter").text(""),disableNextBtn(2),void updateTotalBasket();""!=$("#max-words").val()&&""==$("#min-words").val()&&$("#max-words").val()>0&&$("#min-words").val(1),$("#write-tab-link").find("span.basket-counter").text("(1)")}else $("#write-tab-link").find("span.basket-counter").text("");enableNextBtn(2),appendWriteDiscussionTask(),updateTotalBasket()}else{if(""!=$("#writeTitle").val()&&""!=$("#discussion-title").val()||($("#to-stage-2").data("alert","You need to select an assignment"),$("#write-tab-link, #discussion-tab-link").find("span.basket-counter").text(""),disableNextBtn(2)),""!=$("#writeTitle").val()){if(+$("#min-words").val()>+$("#max-words").val()&&$("#max-words").val()>0)return $("#to-stage-2").data("alert","The minimum number of words can not exceed the maximum number"),$("#write-tab-link").find("span.basket-counter").text(""),disableNextBtn(2),void updateTotalBasket();if(""!=$("#max-words").val()&&""==$("#min-words").val()&&$("#max-words").val()>0&&$("#min-words").val(1),""!=$("#writeTitle").val()&&""==$("#discussion-title").val())return $("#write-tab-link").find("span.basket-counter").text("(1)"),enableNextBtn(2),appendWriteDiscussionTask(),void updateTotalBasket()}if(""!=$("#discussion-title").val()&&""==$("#writeTitle").val())return $("#discussion-tab-link").find("span.basket-counter").text("(1)"),enableNextBtn(2),appendWriteDiscussionTask(),void updateTotalBasket();if(""!=$("#writeTitle").val()&&""!=$("#discussion-title").val())return $("#write-tab-link, #discussion-tab-link").find("span.basket-counter").text("(1)"),enableNextBtn(2),appendWriteDiscussionTask(),void updateTotalBasket();disableNextBtn(2),updateTotalBasket()}}function updateStage3Btn(){var nMinStudents=0;""!=$("#discussion-title").val()?(nMinStudents=1,$("#to-stage-4").data("alert","Select a group or two students at least to continue")):(nMinStudents=0,$("#to-stage-4").data("alert","Select a group or a student to continue")),$(".groups-container").find('input[type="checkbox"]:checked').length||$(".students-container").find('input[type="checkbox"]:checked').length?enableNextBtn(4):disableNextBtn(4)}function updateStage4Btn(){if($("#deadline-date").val().length>9){enableNextBtn(5);var deadlineDateObject=$("#deadline-date").datepicker("getDate");deadlineDateObject.setHours(23),deadlineDateObject.setMinutes(59),deadlineDateObject.setSeconds(59);var timestamp=deadlineDateObject.toISOString();$("#deadline-date-hidden").val(timestamp)}else disableNextBtn(5)}function resetAssignmentsModal(mode){$("#resources-container").empty(),$("#summary-tasks").empty(),$("#edit-task-id").val(""),$("#discussion-title").val(""),$("#discussion-description").val(""),$('input[name="discussion-mode"]').prop("checked",!1),$("#deadline-date").datepicker("update",""),$("#link-instructions").parent().hide(),$("#min-words").val(""),$("#max-words").val(""),$("#min-words").removeAttr("disabled"),$("#max-words").removeAttr("disabled"),$("#resource-success").hide(),$("#drop-writing").parent().show(),$("#drop-discussion").parent().show(),$("#summary-deadline").closest("span.pull-right").show(),$("#selector-write-controls").find(".std-nav-tree-collapse-all").trigger("click"),$("#selector-discussion-controls").find(".std-nav-tree-collapse-all").trigger("click"),$("#selector-read-controls").find(".std-nav-tree-collapse-all").trigger("click"),$("#tree-discussion-selector").find('input[type="checkbox"]:checked').prop("checked",!1),$("#tree-write-selector").find('input[type="checkbox"]:checked').prop("checked",!1),$("#tree-read-selector").find('input[type="checkbox"]:checked').prop("checked",!1),$("#tree-site-page-selector").find('input[type="checkbox"]:checked').prop("checked",!1),$("#tree-resources-pages-selector").find('input[type="checkbox"]:checked').prop("checked",!1),$("#tree-resources-pages-discussion-selector").find('input[type="checkbox"]:checked').prop("checked",!1),$("#tree-read-selector").find(".checkpage:disabled").attr("title","").removeAttr("disabled"),$("#modal-assignment-wizard .students-container label").removeClass("filtered-student"),$("#modal-assignment-wizard .students-container label").removeClass("selected"),$("#typeahead-students").val(""),$(".students-container > label > input").parent().removeClass("filtered-search"),$("span.basket-counter").empty(),$("span.basket-total-tasks").text("0 tasks selected"),$(".set-date").datepicker("remove"),setUpDatepicker(),$("#all-links").length>0&&$("#all-links").remove(),$(".edit-links").length>0&&$(".edit-links").remove(),$("#all-links-discussion").length>0&&$("#all-links-discussion").remove(),$(".edit-links-discussion").length>0&&$(".edit-links-discussion").remove(),$('#qbank-checks input[type="checkbox"]:checked, #editor-qbank-checks input[type="checkbox"]:checked').prop("checked",!1),$("#read-instructions").val(""),$("#instructions, #writeTitle").val(""),"general"!=mode&&null!=mode||($('#modal-assignment-wizard .groups-container input[type="checkbox"]:checked').prop("checked",!1),$('#modal-assignment-wizard .students-container input[type="checkbox"]:checked').prop("checked",!1)),"general"==mode?$("#modal-assignment-wizard .mode-new").show():$("#modal-assignment-wizard > div.modal-footer > div.stage.stage-3 > button:nth-child(1)").show(),$.when($("#modal-assignment-wizard .btn-next").addClass("disabled")).then(updateStage4Btn()),$("#selector-write-box-edit").hide("fast"),$("#pages-tab-link").trigger("click"),$("#typeahead-quizzes, #typeahead-editor-quizzes, #typeahead-site-pages").val("").trigger("keyup"),$("#typeahead-std-pages, #typeahead-std-discussion-pages").val("").trigger("keyup"),"group"!=mode&&"student"!=mode||($(".modal-footer").find("button#to-stage-3").removeClass("disabled"),$(".modal-footer").find("button#to-stage-4").removeClass("disabled")),null==mode&&$("#wizard-multisteps").find("a.step-1").parent("li").hide(),resetWizardMultisteps(mode),$("#to-stage-5").addClass("disabled"),$("ul.filter-in-page-task-type").find('li a[data-type="in-page-all"]').trigger("click"),gotoStage(1)}function searchTaskResources(){$("#write-tab").on("keyup","#typeahead-std-pages",(function(){filterInPageTasks($(this),$("#tree-resources-pages-selector > ul"),"in-page-all","#selector-write-box")}))}function searchTaskDiscussionResources(){$("#discussion-tab").on("keyup","#typeahead-std-discussion-pages",(function(){filterInPageTasks($(this),$("#tree-resources-pages-discussion-selector > ul"),"in-page-all","#selector-discussion-box")}))}function quizAnswer(){$("#reports-panel, #modal-viewer").on("click","#show-quiz-answer",(function(e){e.preventDefault();var idAnswerQuiz=$(this).val(),quizType=$(this).data("quiz-type");previewQuiz(idAnswerQuiz,quizType)})),$("#reports-panel, #modal-viewer").on("focusout","input.grade-n-nom",(function(e){var num=parseInt($(this).val()),den=parseInt($(this).attr("max")),inputPerc=$(this).closest(".grade-answer").find(".grade-p").find("input");num>=den?($(this).val(den),inputPerc.val(100)):inputPerc.val(Math.round(100*num/den))})),$("#reports-panel, #modal-viewer").on("click","#answer-save-grades",(function(e){e.preventDefault(),saveAnswerGrades()})),$("#reports-panel, #modal-viewer").on("change","#answer-grade-system",(function(){"number"===$(this).val()?($("#log-table").find(".grade-answer > .grade-n").show(),$("#log-table").find(".grade-answer > .grade-p").hide(),$("#reports-panel, #modal-viewer").find("#answer-grade-denominator").show()):($("#log-table").find(".grade-answer > .grade-n").hide(),$("#log-table").find(".grade-answer > .grade-p").show(),$("#reports-panel, #modal-viewer").find("#answer-grade-denominator").hide())})),$("#reports-panel, #modal-viewer").on("change keyup","#answer-grade-denominator > input#grade-number",(function(){var gradeNumber=$(this).val();""!=gradeNumber&&$("#log-table").find(".grade-answer > .grade-n").each((function(){var input=$(this).find("input");if(input.attr("max",gradeNumber),parseInt(input.val())>gradeNumber&&input.val(gradeNumber),$(this).find("span").text(gradeNumber),""!=input.val()){var numerator=parseInt(input.val()),denominator=gradeNumber,percentage=Math.round(100*numerator/denominator),inputPerc;$(this).closest(".grade-answer").find(".grade-p").find("input").val(percentage)}}))}))}function saveAnswerGrades(){var values=[],taskId=$("#task-id").val(),report=$("#reports-panel, #modal-viewer"),tableRows=report.find("table#log-table > tbody > tr"),gradeSystem=report.find("#answer-grade-system").val(),mustGradeSomeone=!1;if($.each(tableRows,(function(){if(v={"task-student":$(this).data("stdtask"),student:$(this).data("std"),"submit-time":$(this).find(".localdate").data("time"),mark:null,score:null},"number"==gradeSystem&&$(this).find("input.grade-n-nom").val().trim().length){var inputGrade=$(this).find("input.grade-n-nom");v.mark=[parseInt(inputGrade.val()),inputGrade.attr("max")].join("/"),v.score=parseInt($(this).find(".grade-p > input").val()),values.push(v),mustGradeSomeone=!0}else"percent"==gradeSystem&&$(this).find(".grade-p > input").val().trim().length&&(v.score=parseInt($(this).find(".grade-p > input").val()),values.push(v),mustGradeSomeone=!0)})),mustGradeSomeone){report.find("#answer-save-grades").addClass("disabled").html('<i class="fa fa-spin fa-circle-o-notch"></i> Saving...');var data={action:"save-answer-grades",task:taskId,subject:$("#general-id").val(),ticket:$("#ticket").val(),grades:values};$.post("/pages/std-access/std-assignments-report-actions.php",data,(function(response){if(1==response.success){var stdScores=response.stdScores?response.stdScores:[];if(report.find("#answer-save-grades").html('<i class="fa fa-check"></i> Successfully saved!'),setTimeout((function(){report.find("#answer-save-grades").removeClass("disabled").html('<i class="fa fa-save"></i> Save grades')}),5e3),"undefined"!=typeof studentId)loadTasksList("student",studentId);else if($("#group-id").length>0){if($("#gradebook").is(":visible")){var gradeView=$("#gradeview").val(),tdTaskIndex=$("#students-scrollable-table > thead").find('th[data-task="'+taskId+'"]').index();$.each(stdScores,(function(k,v){var tr;$("#students-scrollable-table > tbody").find('tr[data-student="'+v.student_id+'"]').find("td").eq(tdTaskIndex).html(["<div>","score"==gradeView?v.score+"%":v.mark?v.mark:v.score,'<ul class="float-menu" style="cursor: default; display: none;">','<li><a class="open-task-report" href="#"><i class="fa fa-fw fa-bar-chart"></i> ',"Open student task report</a>","</li>",'<li><a class="reset-task-student" href="#"><i class="fa fa-fw fa-undo"></i> ',"Reset task for the student</a>","</li>","</ul>","</div>"].join(""))}))}loadTasksList("group",$("#group-id").val())}else loadTasksList("general");$(".task-navigator-container").hide()}else 0==response.success&&(alert(response.msg),report.find("#answer-save-grades").removeClass("disabled").html('<i class="fa fa-save"></i> Save grades'))}),"json")}}function appendLinksWriting(){$("#link-instructions").focusout((function(){""!=$(this).val()?disableNextBtn(2):enableNextBtn(2)})),$("#drop-writing").click((function(){var addHeight;$(this).parent().hasClass("open")?$(this).closest(".row-fluid").css("height","inherit"):$(this).closest(".row-fluid").css("height","100px")})),$("#student-page").click((function(e){e.preventDefault();var wizardBody=document.getElementById("wizard-body");$("#selector-write-box").show(),$("#link-instructions").parent().hide(),$("#resource-success").show(),$("#drop-writing").parent().hide(),$("#search-std-pages").show(),wizardBody.scrollTop=wizardBody.scrollHeight})),$("#external-link").click((function(e){e.preventDefault();var wizardBody=document.getElementById("wizard-body");$("#selector-write-box").hide(),$("#tree-resources-pages-selector").hide(),$("#link-instructions").parent().show(),$("#resource-success").show(),$("#drop-writing").parent().hide(),$("#typeahead-std-pages").val(""),$("#search-std-pages").hide(),wizardBody.scrollTop=wizardBody.scrollHeight})),$("#resource-success").click((function(e){$(this).hide(),$("#drop-writing").parent().show(),$("#selector-write-box").hide(),$("#link-instructions").parent().hide()})),$(document).on("click","#add-link-instructions",(function(){var url=$("#link-instructions").val();if(validURL(url=url.replace(/\s/g,""))){url=properlyURLLinks(url);var linkResources=$("#link-resources");0==$("#all-links").length&&linkResources.append('<ul id="all-links" style="margin-left: 0;"></ul>'),$("#all-links").append(`<li class="external-links">                 <a href="${url}" target="_blank">${url}</a>                 <i title="Remove external link" class="fa fa-trash-o colored link-resource" style="cursor: pointer;"></i>             </li>`),$("#link-instructions").val(""),""!=$("#writeTitle").val()&&enableNextBtn(2)}else $("#link-instructions").val(""),alert("The URL that you are trying to put, is not valid.\n\nExample valid URL: "+SITE_URI),enableNextBtn(2)})),$(document).on("click",".link-resource",(function(){var pageId=$(this).parent().data("pageid");if("undefined"!=pageId&&($('#link-resources > ul > li[data-pageid="'+pageId+'"]').remove(),$('#resources-container li.write-0 ul > li[data-pageid="'+pageId+'"]').remove()),$(this).parent().hasClass("external-links")){var href=$(this).parent().find("a").attr("href");$("#link-resources > ul > li.external-links").find('a[href="'+href+'"]').parent().remove(),$("#resources-container li.write-0 ul > li.external-links").find('a[href="'+href+'"]').parent().remove()}$("#tree-write-selector").find("#check-"+pageId).attr("checked",!1),$("#tree-resources-pages-selector").find('input[value="'+pageId+'"]').attr("checked",!1),0==$("#link-resources > ul").children().length&&($("#link-resources > ul").remove(),$("li#student-page, li#external-link").css("margin-top","0"))})),$(document).on("click",".link-resource-discussion",(function(){var pageId=$(this).parent().data("pageid");if("undefined"!=pageId&&($('#link-resources-discussion > ul > li[data-pageid="'+pageId+'"]').remove(),$('#resources-container li.discussion-0 ul > li[data-pageid="'+pageId+'"]').remove()),$(this).parent().hasClass("external-links")){var href=$(this).parent().find("a").attr("href");$("#link-resources-discussion > ul > li.external-links").find('a[href="'+href+'"]').parent().remove(),$("#resources-container li.discussion-0 ul > li.external-links").find('a[href="'+href+'"]').parent().remove()}$("#tree-discussion-selector").find("#check-"+pageId).attr("checked",!1),$("#tree-resources-pages-discussion-selector").find('input[value="'+pageId+'"]').attr("checked",!1),0==$("#link-resources-discussion > ul").children().length&&($("#link-resources-discussion > ul").remove(),$("li#student-page-discussion, li#external-link-discussion").css("margin-top","0"))}))}function appendLinksDiscussion(){$("#add-link-description").focusout((function(){""!=$(this).val()?disableNextBtn(2):enableNextBtn(2)})),$("#drop-discussion").click((function(){var addHeight;$(this).parent().hasClass("open")?$(this).closest(".row-fluid").css("height","inherit"):$(this).closest(".row-fluid").css("height","100px")})),$("#student-page-discussion").click((function(e){e.preventDefault();var wizardBody=document.getElementById("wizard-body");$("#search-std-discussion-pages").show(),$("#selector-discussion-box").show(),$("#add-link-description").parent().hide(),$("#resource-success-discussion").show(),$("#drop-discussion").parent().hide(),wizardBody.scrollTop=wizardBody.scrollHeight})),$("#external-link-discussion").click((function(e){e.preventDefault();var wizardBody=document.getElementById("wizard-body");$("#selector-discussion-box").hide(),$("#tree-resources-pages-discussion-selector").hide(),$("#add-link-description").parent().show(),$("#resource-success-discussion").show(),$("#drop-discussion").parent().hide(),$("#typeahead-std-discussion-pages").val(""),$("#search-std-discussion-pages").hide(),wizardBody.scrollTop=wizardBody.scrollHeight})),$("#resource-success-discussion").click((function(e){$(this).hide(),$("#drop-discussion").parent().show(),$("#selector-discussion-box").hide(),$("#add-link-description").parent().hide()})),$(document).on("click","#add-link",(function(){var url=$("#add-link-description").val();if(validURL(url=url.replace(/\s/g,""))){url=properlyURLLinks(url);var linkResources=$("#link-resources-discussion");0==$("#all-links-discussion").length&&linkResources.append('<ul id="all-links-discussion" style="margin-left: 0;"></ul>'),$("#all-links-discussion").append(`<li class="external-links">                 <a href="${url}" target="_blank">${url}</a>                 <i title="Remove external link" class="fa fa-trash-o colored link-resource-discussion" style="cursor: pointer;"></i>             </li>`),$("#add-link-description").val(""),""!=$("#discussion-title").val()&&enableNextBtn(2)}else $("#add-link-description").val(""),alert("The URL that you are trying to put, is not valid.\n\nExample valid URL: "+SITE_URI),enableNextBtn(2)})),$(document).on("click","#link-resources-discussion > ul > li > .link-resource-discussion",(function(){var pageId=$(this).parent().data("pageid");$(this).parent().remove(),$("#tree-discussion-selector").find("#check-"+pageId).attr("checked",!1),0==$("#link-resources-discussion > ul").children().length&&$("#link-resources-discussion > ul").remove()}))}function searchInPageTaskResources(){$("#pages-tab").on("keyup","#typeahead-site-pages",(function(){var typeahead=$(this),target=typeahead.attr("data-target");filterInPageTasks(typeahead,$("#tree-site-page-selector > ul"),target,"#selector-read-box")}))}function filterBySitePagesTasks(element){var treeSitePageSelectorListElement=$("#tree-site-page-selector > ul > li"),nManualTask=treeSitePageSelectorListElement.find('input[data-is-manual-task="yes"]').length,nQuizPage=treeSitePageSelectorListElement.find('input[data-is-quiz-page="true"]').length,nWrittenAnswer=treeSitePageSelectorListElement.find('input[data-written-answer="yes"]').length;numberOfTasksByType(element,nManualTask,"in-page-written-tasks"),numberOfTasksByType(element,nQuizPage,"in-page-quizzes"),numberOfTasksByType(element,nWrittenAnswer,"in-page-written-answers"),element.on("click","ul.filter-in-page-task-type > li > a",(function(e){e.preventDefault();var typeaheadSitePages=$("#typeahead-site-pages"),inPageTasksDropdown=$(this);inPageTasksDropdown.closest(".dropdown").children("a").html(inPageTasksDropdown.html()+' <b class="caret" style="float: right;"></b>'),typeaheadSitePages.val("");var target=inPageTasksDropdown.attr("data-type");typeaheadSitePages.attr("data-target",target),filterInPageTasks($("#typeahead-site-pages"),$("#tree-site-page-selector > ul"),target,"#selector-read-box",!0)}))}function numberOfTasksByType(element,nTasks,type){var inPageTask=element.find("ul.filter-in-page-task-type").find("a[data-type='"+type+"']");inPageTask.append("<span class='n-total'>("+nTasks+")</span>"),0===nTasks&&inPageTask.remove()}function filterInPageTasks(el,pageList,target,selectorTreeBox,findByType=!1){var words=el.val().toLowerCase(),list=pageList,allInPageTasks="in-page-all"===target;list.find("li.std-resource").hide(),(""===words||findByType)&&($(selectorTreeBox).toggle(allInPageTasks),list.parent().toggle(!allInPageTasks),!allInPageTasks&&findResources(list,target,words,findByType)),words.length>0&&!findByType&&(allInPageTasks&&$(selectorTreeBox).hide(),list.parent().show(),findResources(list,target,words,findByType))}function findResources(list,target,words,findByType){list.find("li.std-resource").each((function(){var showAllInPageTasks="in-page-all"===target,showInPageQuizzes="in-page-quizzes"===target&&$(this).find('input[data-is-quiz-page="true"]').length,showInPageWrittenTasks="in-page-written-tasks"===target&&$(this).find('input[data-is-manual-task="yes"]').length,showInPageWrittenAnswers="in-page-written-answers"===target&&$(this).find('input[data-written-answer="yes"]').length;showAllInPageTasks&&showResourcesMatched($(this),words,findByType),showInPageQuizzes&&showResourcesMatched($(this),words,findByType),showInPageWrittenTasks&&showResourcesMatched($(this),words,findByType),showInPageWrittenAnswers&&showResourcesMatched($(this),words,findByType)})),list.find("li.std-resource:visible").length?list.find("li.not-found").hide():list.find("li.not-found").show()}function showResourcesMatched(element,words,findByType){var liText=element.find(".title").text().toLowerCase().trim();findByType?element.show():element.toggle(liText.indexOf(words)>=0)}function appendResource(id,name,type,extraData,combinedType=""){var icon="",notes="",examMode="",requiredTask="",quizScoreAnswers="",writtenScoreAnswers="",extraData="string"==typeof extraData?extraData:"",quizChecked="quiz-page"===combinedType||""===combinedType?"checked":"",writtenTaskChecked="manual-task"===combinedType||""===combinedType?"checked":"",placeHolder,instructions='<input type="text" class="in-page-instructions instructions" placeholder="'+("written-answer"!=type?"Instructions (optional)":"Instructions (required)")+'..." value="'+(notes=null!=$("#read-instructions").val()&&$("#read-instructions").val().length>0?$("#read-instructions").val():"")+'"/>',customResources="";switch(type){case"read":icon='<i class="fa fa-file fixwidth colored"></i>',instructions='<textarea class="in-page-instructions instructions description empty" placeholder="Instructions (optional)...">'+notes+"</textarea>";break;case"in-page-combined-task":icon='<i class="fa fa-puzzle-piece fa-fw colored"></i><i class="fa fa-edit fa-fw colored"></i>&nbsp;',instructions='<textarea class="in-page-instructions instructions description empty" placeholder="Instructions (optional)...">'+notes+"</textarea>",requiredTask=['<div class="span6 combined-tasks-edit">','<label style="font-weight: normal;">Exclude tasks</label>','<label class="checkbox combined-task-required">','<input class="quiz-task-combined" type="checkbox" '+quizChecked+">",'<i class="fa fa-fw colored fa-puzzle-piece"></i> Quiz task',"</label>",'<label class="checkbox combined-task-required">','<input class="written-task-combined" type="checkbox" '+writtenTaskChecked+">",'<i class="fa fa-fw colored fa-edit"></i> Written task',"</label>","</div>"].join(""),quizScoreAnswers='<td class="score-answers-container">'+printQuizScoreAnswersOptions(id,!0)+"</td>",examMode=printExamModeOption();break;case"write":$("#resources-container li.write-0").remove(),icon='<i class="fa fa-pencil fixwidth colored"></i>',instructionsText=$("#instructions").val(),minWords=$("#min-words").val(),maxWords=$("#max-words").val(),instructions=['<textarea class="instructions empty" placeholder="Instructions (optional)...">'+instructionsText+"</textarea>"].join(""),customResources='<div class="write-resources"></div>',examMode=printExamModeOption();break;case"discussion":$("#resources-container li.discussion-0").remove(),icon='<i class="fa fa-comments fixwidth" style="color: purple"></i>',description=$("#discussion-description").val(),instructions='<textarea class="description empty" placeholder="Instructions (optional)...">'+description+"</textarea>",customResources='<div class="discussion-resources"></div>';break;case"quiz":case"quiz-page":icon='<i class="fa fa-puzzle-piece fixwidth colored"></i>',null!=$("#std-is-quiz-page").val()&&($("#quiz-comment-box").val().length>0&&(notes=$("#quiz-comment-box").val()),instructions='<textarea id="read-notes-append" class="in-page-instructions description empty">'+notes+"</textarea>"),"quiz-page"===type&&(requiredTask=printRequiredTask("fa-puzzle-piece","Quiz")),quizScoreAnswers='<td class="score-answers-container">'+printQuizScoreAnswersOptions(id,!1)+"</td>",examMode=printExamModeOption();break;case"written-answer":icon='<i class="fa fa-file-text-o fixwidth colored"></i>',instructions='<textarea class="instructions" style="height: 2.2em;"></textarea>',instructions+=['<div id="quiz-opts" style="margin-top: 10px">','<label class="checkbox">','<input class="see-answers" type="checkbox"/>',"&nbsp;Allow students to see answers","</label>",'<label class="checkbox">','<input class="see-w-solutions" type="checkbox"/>',"&nbsp;Allow students to see worked solutions","</label>","</div>"].join("");break;case"model-answer":icon='<i class="fa fa-file-text fixwidth colored"></i>';break;case"short-answer":icon='<i class="fa fa-edit fixwidth colored"></i>',examMode=printExamModeOption(),requiredTask=printRequiredTask("fa-edit","In-page written"),writtenScoreAnswers='<td class="score-answers-container">'+printWrittenScoreAnswersOptions(id)+"</td>"}""==$("#writeTitle").val()&&$("#resources-container li.write-0").remove(),""==$("#discussion-title").val()&&$("#resources-container li.discussion-0").remove();var individualDeadline=["<label>Change deadline</label>",'<div class="input-prepend">','<span class="add-on"><i class="fa fa-calendar"></i></span>','<input id="deadline-date-'+id+'" type="text" value="" class="set-date" ','data-date-start-date="new Date()" data-date-format="dd M yyyy">',"</div>"].join(""),resourceToAppend=['<li class="'+type+"-"+id+'">','<table style="width: 100%; margin-bottom: 0;">',"<tr>",'<td class="data" data-id="'+id+'" data-type="'+type+'" '+extraData+' style="position: relative;">','<i class="fa fa-trash-o colored remove-task" title="Remove task"></i>','<span class="icon">'+icon+"</span>",'<strong class="title">'+name.trim()+"</strong>",instructions,'<div class="accordion set-custom-deadline">','<div class="accordion-group">','<div class="accordion-heading">','<a class="accordion-toggle collapsed" data-toggle="collapse" href="#date-accordion-'+type+"-"+id+'">','<i class="fa fa-fw fa-caret-down" style="margin-left: -5px;"></i>',"More options","</a>","</div>",'<div id="date-accordion-'+type+"-"+id+'" class="accordion-body collapse">','<div class="accordion-inner">','<table class="more-options">','<tr style="'+("read"!==type?"":"display: none;")+'">',quizScoreAnswers,writtenScoreAnswers,"<td>"+("read"!==type?requiredTask:"")+"</td>","</tr>","<tr>",'<td style="padding-top: 20px;">'+individualDeadline+"</td>",'<td style="padding-top: 20px;">'+("read"!==type?examMode:"")+"</td>","</tr>","</table>","</div>","</div>","</div>","</div>",customResources,'<i class="fa fa-lg fa-arrows move-resource" style="color: #666;"></i>',"</td>","</tr>","</table>","</li>"].join("");$("#resources-container").append(resourceToAppend),setUpDatepicker(),Sortable.create(document.getElementById("resources-container"),{handle:".move-resource",direction:"vertical",animation:300})}function removeTaskFromEdit(){$("#resources-container").on("click","i.remove-task",(function(e){e.preventDefault();var taskRow=$(this).closest("td.data"),taskId=taskRow.data("id"),taskType=taskRow.data("type");switch(taskType){case"read":case"quiz-page":case"in-page-combined-task":case"short-answer":$("#tree-site-page-selector").find("input[value="+taskId+'][type="checkbox"]').prop("checked",!1),$('input[type="checkbox"][data-id="'+taskId+'"]').attr("checked",!1);break;case"quiz":case"written-answer":case"model-answer":$.when($("li#ql-"+taskId).find('input[type="checkbox"]').attr("checked",!1)).then(updateBasket("qbank"));break;case"write":$.when($("#writeTitle, #instructions, #min-words, #max-words").val(""),$("ul#all-links, ul.edit-links").remove(),$("#student-page, #external-link").css("margin-top","0"),$("#write-tab-link").find("span.basket-counter").text("")).then(updateTotalBasket());break;case"discussion":$.when($("#discussion-title, #discussion-description").val(""),$("ul#all-links-discussion, ul.edit-links-discussion").remove(),$("#student-page-discussion, #external-link-discussion").css("margin-top","0"),$("#discussion-tab-link").find("span.basket-counter").text("")).then(updateTotalBasket())}taskRow.closest("li").fadeOut("fast",(function(){$(this).remove(),updateResourcesContainer(),updateBasket(taskType)}))}))}function updateResourcesContainer(){0==$("#resources-container").find("li").length&&($("a.step-5").parent("li").removeClass("visited"),$("#to-stage-5").addClass("disabled"))}function printQuizScoreAnswersOptions(id,combined_task){return["<label>Results options for students</label>",'<label class="radio">','<input type="radio" name="score-answer-options-'+id+'" id="score-answer-'+id+'-opt1" ','value="opt1-'+id+'" data-opt="0" checked="checked">',"Show score & answers on completion of task","</label>",'<label class="radio">','<input type="radio" name="score-answer-options-'+id+'" id="score-answer-'+id+'-opt2" ','value="opt2-'+id+'" data-opt="1">',"Show score on completion of task & answers after deadline","</label>",'<label class="radio">','<input type="radio" name="score-answer-options-'+id+'" id="score-answer-'+id+'-opt3" ','value="opt3-'+id+'" data-opt="2">',"Show score & answers after deadline","</label>"].join("")}function printWrittenScoreAnswersOptions(id,hasModelAnswers=!1){return["<label>Submit options</label>",'<label class="radio">','<input type="radio" name="score-answer-options-'+id+'" id="score-answer-'+id+'-opt1" ','value="opt1-'+id+'" data-opt="0" checked="checked">',"Show answers on completion of the task","</label>",'<label class="radio">','<input type="radio" name="score-answer-options-'+id+'" id="score-answer-'+id+'-opt3" ','value="opt3-'+id+'" data-opt="2">',"Show answers after deadline","</label>"].join("")}function printExamModeOption(){return['<div class="exam-mode-container">',"<label>Exam mode</label>",'<div class="input-prepend">','<span class="add-on">','<i class="fa fa-clock-o"></i>',"</span>",'<input class="exam_mode_minutes" type="number" min="1" max="120" placeholder="minutes" style="padding: 6px;">',"</div>","</div>"].join("")}function printRequiredTask(icon,text){return inPageTaskEvents(),["<label>Exclude task</label>",'<label class="checkbox task-required">','<input type="checkbox" checked><i class="fa fa-fw colored '+icon+'"></i>',text,"</label>"].join("")}function inPageTaskEvents(){$("#wizard-body .stage-4").on("change",".task-required > input",(function(e){e.preventDefault();var checkbox=$(this),taskIcon=checkbox.parent().find("i").attr("class"),examMode=checkbox.closest("td.data").find(".exam-mode-container"),checked=checkbox.is(":checked"),scoreAnswers=checkbox.closest("td.data").find(".score-answers-container");checked?(checkbox.closest("td.data").find("span.icon > i").attr("class",taskIcon),checkbox.closest("td.data").attr("data-type",taskIcon.indexOf("puzzle")>=0?"quiz-page":"short-answer"),checkbox.closest("td.data").data("type",taskIcon.indexOf("puzzle")>=0?"quiz-page":"short-answer"),examMode.find(".exam_mode_minutes").val(""),examMode.find(".exam_mode_minutes").attr("disabled",!1),examMode.find("label").css("color","#242424"),examMode.find(".add-on > i").css("color","#242424"),scoreAnswers.removeClass("disabled"),scoreAnswers.find('input[type="radio"]').attr("disabled",!1)):(checkbox.closest("td.data").find("span.icon > i").attr("class","fa fa-file fixwidth colored"),checkbox.closest("td.data").attr("data-type","read"),checkbox.closest("td.data").data("type","read"),examMode.find(".exam_mode_minutes").attr("disabled",!0),examMode.find("label").css("color","#ddd !important"),examMode.find(".add-on > i").css("color","#ddd"),scoreAnswers.addClass("disabled"),scoreAnswers.find('input[type="radio"]:first').prop("checked",!0),scoreAnswers.find('input[type="radio"]').attr("disabled",!0))}))}var currentStage=1;function gotoStage(n){4==currentStage&&""!=$("#edit-task-id").val()?$("#start-over").hide():$("#start-over").show();var breadcrumbs=$("#wizard-multisteps"),stage=$("#modal-assignment-wizard .stage-"+n),header=$("h3.stage-"+n);$.when($("#modal-assignment-wizard .stage").hide()).then(stage.show(),breadcrumbs.insertAfter(header)),currentStage=n}function setWizardMultistepStage(stage){$("#wizard-multisteps").find("li > a").each((function(){var step=$(this),n=step.data("step");stage==n?step.parent("li").addClass("current"):step.parent("li").removeClass("current")}));var currentStep=$("#wizard-multisteps li.current").find("a").data("step");for(let i=1;i<currentStep;i++)$("#wizard-multisteps").find('li > a[data-step="'+i+'"]').parent("li").removeClass().addClass("visited");toggleBreadcrumbsDivider()}function enableNextBtn(n){$("#to-stage-"+n).removeClass("disabled"),$("#wizard-multisteps").find("li > a").each((function(i){var step=$(this).data("step"),count=i+1;if(parseInt(step)>=n){var nextStage=count+1,button;if($(".modal-footer").find("button#to-stage-"+nextStage).hasClass("disabled"))return!1;$(this).parent("li").removeClass().addClass("visited")}})),toggleBreadcrumbsDivider()}function disableNextBtn(n){$("#to-stage-"+n).addClass("disabled"),$("#wizard-multisteps").find("li > a").each((function(){var step=$(this).data("step");parseInt(step)>=n&&$(this).parent("li").removeClass()})),toggleBreadcrumbsDivider()}function appendWriteDiscussionTask(){""!=$("#writeTitle").val()&&($("#resources-container").find("li.write-0").length&&$("#resources-container").find("li.write-0").remove(),appendResource(0,$("#writeTitle").val(),"write")),""!=$("#discussion-title").val()&&($("#resources-container").find("li.discussion-0").length&&$("#resources-container").find("li.discussion-0").remove(),appendResource(0,$("#discussion-title").val(),"discussion"))}function resetWizardMultisteps(mode){$("#wizard-multisteps").find("ul > li").each((function(i){var n=i+1,step=$(this);step.removeClass(),(1==n||null==mode&&2==n)&&step.addClass("current")}))}function toggleBreadcrumbsDivider(){$("#wizard-multisteps").find("li").each((function(){var step=$(this);step.is(".current, .visited")?step.prev("li").find("span.divider > i").css({color:"#5e7ca1",opacity:"0.8"}):step.prev("li").find("span.divider > i").css({color:"#ccc",opacity:"1"})}))}function fixStagesNums(){null==$("#std-task-id").val()&&($(".stage-3").find("span").eq(0).text("2."),$(".stage-4").find("span").eq(0).text("3."),$(".stage-5").find("span").eq(0).text("4."))}function loadTaskReview(first,second,mode,taskType=null,stdName="",gradeStatus=""){var writeTaskId=stdTaskId=taskId=studentId="";"student"==mode||"report"==mode?(stdTaskId=first,writeTaskId=second):"group"==mode&&(taskId=first,studentId=second),$(".task-filter-fields").hide("fast");var url="/pages/std-access/std-assignments-report-actions.php",data={action:"load-review",mode:mode,"write-task-id":writeTaskId,"std-task-id":stdTaskId,"task-id":taskId,"student-id":studentId,ticket:$("#ticket").val()};$.post(url,data,(function(response){if(1==response.success){$("#modal-write-std-name").text($("h1.breadcrumbed-title").text()),"report"!=mode&&"group"!=mode||""==stdName||$("#modal-write-std-name").text(stdName),"group"==mode&&$('#students-scrollable-table tr[data-student="'+studentId+'"]').find("ul.float-menu").hide();var answerContainer=$("#modal-write-std-answer");answerContainer.css("overflow","hidden"),$("#modal-write-task-title").html(response.title),$("#modal-write-std-details").html(response.header),$("#std-response-info").html(response.info),$("#std-response-info").find("tr.written-words").show(),$("#threads").html(response.threads),"write"===taskType&&"string"==typeof response.content&&answerContainer.attr("class","custom-essay"),answerContainer.html(response.content),$(".thread-list").is(":empty")&&$(".thread-list").css({border:"none",padding:"0","overflow-y":"unset"}),$("#modal-write-std-details").is(":empty")&&$("#modal-write-std-details").remove(),$(".teacher-section").show(),$(".std-response").show(),$("#modal-mark-score").val(response.mark),$("#modal-mark-denominator").val(response.denominator),$("#modal-grade-system").val(response["grade-system"]),$("#modal-write-score").val(response.score),$("#modal-write-teacher-notes").val(response.notes),$("#modal-write-teacher-notes").val().trim().length>0&&$("#modal-write-delete-private-notes").attr("disabled",!1),currentStd=response["std-id"],$("#modal-write-std").val(response["std-id"]),$("#modal-std-task-id").val(response["std-task-id"]),$("#modal-write-instructor").val(response.instructor),$("#modal-write-user-type").val(response["user-type"]),$("#modal-write-std-log").val(response["written-task-id"]),$("#modal-write-general-id").val(response["general-id"]),"short-answer"==taskType&&($.when(getEditorAnswers(response.tib_quizzes)).then((function(answers){appendEditorAnswers(answerContainer,answers,"right")})),showEssayWordLimit(),$.when(getEditorNotes(response.tib_quizzes)).then((function(notes){appendEditorNotes(answerContainer,notes),checkEmptyNotes()})),$("p.std-manual-answer").filter((function(i,a){return 0==$.trim($(a).text()).length})).append('<span class="std-no-manual-answer">No answer submitted</span>'),$("#dedicated-upload-list").find("li.dedicated-upload-file").length&&$(".dedicated-uploader").find(".header").text("Student's answer(s)")),"group"==mode&&$("#modal-write-task-id").val(taskId),$("span.std-no-manual-answer").length>0&&$("span.w-count-words").text("0"),"undefined"!=typeof moveToNextStd&&$("#modal-write-details").find(".modal-footer").toggle(moveToNextStd),$('a[data-wtid="'+writeTaskId+'"][data-tsid="'+stdTaskId+'"] span.message').remove(),$("#modal-task-status").html('<i class="fa fa-floppy-o"></i> Saved'),response["grade-sent"]&&hideSaveBtn(),response.saved&&$("#modal-write-send").attr("disabled",!1),$("#toggle-inline-comments").hide(),$("#print-task-review").show(),answerHasComments(answerContainer)&&showInlineCommentsToggler(),answerContainer.find(".manual-q-answer .std-manual-answer").each((function(){if($(this).hasClass("well")||$(this).addClass("well"),$(this).find("p").last().css("margin-bottom","0px"),$(this).find("figure.image figcaption").length){var caption=$(this).find("figure.image figcaption");caption.text().trim().length||caption.text("Uploaded image")}})),setModalGradeSystem(),$(".teacher-section").find("textarea").each((function(){this.setAttribute("style","height: 65px; overflow-y: hidden;"),this.setAttribute("style","height:"+this.scrollHeight+"px; overflow-y: hidden;")})).on("input",(function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"}));var hideShowComments="on"==$("#toggle-inline-comments").data("toggled")?"s":"h",printTaskLink=$("#print-task-review").find("a").attr("href");printTaskLink=printTaskLink.substring(0,printTaskLink.indexOf("?")),printTaskLink+="?wtid="+$("#modal-write-std-log").val()+"&m=t&c="+hideShowComments,$("#print-task-review").find("a").attr("href",printTaskLink),$("#modal-write-details").modal("show"),$("#modal-write-details").one("shown.bs.modal",(function(){$("#modal-write-details").find("#toggle-inline-comments").attr("data-toggled","on").data("toggled","on"),stdCompletedList=JSON.parse(response.completed_std_ids),stdList=[],"group"==mode&&$("#students-scrollable-table").find('tbody > tr[data-student][data-removed="no"]').each((function(){var stdId=$(this).data("student");stdList.push(parseInt(stdId))})),"report"==mode&&$("#log-table").find("tbody > tr").each((function(){var stdId=$(this).attr("id").replace("task-write-","");stdList.push(parseInt(stdId))})),$("#go-to-next-task, #go-to-previous-task").attr("disabled",1==stdList.length),update_local_dates($("#modal-write-details")),$("#modal-task-type").val(taskType)})),MathLive.renderMathInDocument()}else 2==response.success?($("#modal-write-std-name").text(stdName),"group"==mode&&$('#students-scrollable-table tr[data-student="'+studentId+'"]').find("ul.float-menu").hide(),$(".teacher-section").hide(),$(".std-response").hide(),$("#toggle-inline-comments").hide(),$("#print-task-review").hide(),$("#modal-write-std").val(currentStd),$("#modal-std-task-id").val(response["std-task-id"]),$("#std-response-info").find("span.submit-date").html(getGradeStatus(gradeStatus)),$("#std-response-info").find("tr.written-words").hide()):alert(response.msg)}),"json")}function loadStudentReportMinimal(taskID,stdId,generalId,type=null,stdName=""){var data={task:taskID,student_id:stdId,general_id:generalId,ticket:$("#ticket").val()},url="/pages/std-access/std-dedicated-student.php?action=load-report";$.post(url,data,(function(response){1==response.success?$.when($("#modal-load-report .modal-header h3").html(stdName),$("#modal-load-report .modal-std-task-title h3").html(response.title),$("#modal-load-report .modal-body").html(response.html),$("#modal-load-report").css("top","10%"),$("#modal-load-report .modal-body").css("max-height",parseInt(.6*$(window).height())+"px"),$("#modal-load-report").modal("show"),$("#modal-load-report").on("shown.bs.modal",(function(){"read"==type&&$("#modal-load-report").css({width:.7*$(window).width()+"px","margin-left":"-"+.7*$(window).width()/2+"px"}),null!=type&&"read"!=type&&($('input[name="std-id"]').val(stdId),$('input[name="task-id"]').val(taskID),$('input[name="saved-score"]').val($("span.score-editable").text().replace(/\(.*\)/g,"").trim()),MathLive.renderMathInDocument(),$("#modal-load-report").css({width:.8*$(window).width()+"px","margin-left":"-"+.8*$(window).width()/2+"px"}),$("#modal-load-report").find(".modal-body").css("max-height","calc(100vh - "+.3*$(window).height()+"px)"),$("#modal-load-report").find(".modal-body, .modal-footer").css("overflow-y","auto"),$("#modal-load-report").find(".modal-footer").css("max-height",.2*$(window).height()+"px"))})),numberQuizQuestions(),addLettersBeforeOptions()).then(update_local_dates($("#modal-load-report"))):alert(response.msg)}),"json")}function loadReportMinimal(taskID,title,generalId,taskStatus,stdName=""){taskStatus=void 0!==taskStatus?taskStatus:"completed";var data={action:"load-report-minimal",task:taskID,subject:generalId,ticket:$("#ticket").val()},url="/pages/std-access/std-assignments-report-actions.php";$.post(url,data,(function(response){if(1==response.success){var h=$(window).height(),w=$(window).width();$("#modal-viewer").css({top:"10px",width:.6*w+"px","margin-left":"-"+.6*w/2+"px"}),$("#modal-viewer .modal-body").css({height:h-400+"px","max-height":h-400+"px"}),$("#modal-viewer .modal-header h3").html(stdName),$("#modal-viewer .modal-body").html(response.html),$("#modal-viewer .modal-std-task-title h3").html(response.title),$("#modal-viewer #modal-viewer-body > article").hide(),$("#close-report-answer").length&&($("#task-title").hide(),$("#close-report-answer").hide()),$("#modal-viewer").modal("show"),$("#modal-viewer").on("shown.bs.modal",(function(){$("#modal-viewer").css({width:.8*$(window).width()+"px","margin-left":"-"+.8*$(window).width()/2+"px"}),$("#modal-viewer").find(".modal-body").css("max-height","calc(100vh - "+.2*$(window).height()+"px)"),$("#modal-viewer").find(".modal-body, .modal-footer").css("overflow-y","auto"),$("#modal-viewer").find(".modal-footer").css("max-height",.2*$(window).height()+"px")}))}else closeReport(),alert(response.msg)}),"json")}function saveAssignment(mode,id,andSend){var selectedRecipients=getSelectedRecipients("#modal-assignment-wizard"),resources=[],resourcePos=0;$("#resources-container").find("td.data").each((function(){var extra={},title="",notes="",mResources="",examTime="",customDeadline=null,discussionType=null,seeScoreAnswers=0,dataType=$(this).attr("data-type");if(hasCustomDeadline){var deadlineDateObject=$(this).find("input.set-date").datepicker("getDate");deadlineDateObject.setHours(23),deadlineDateObject.setMinutes(59),deadlineDateObject.setSeconds(59),customDeadline=deadlineDateObject.toISOString()}if("write"==dataType){var min=$(this).find("input.min-words").val(),max=$(this).find("input.max-words").val();if(""==min&&(min=$(this).find(".words").data("min")),""==max&&(max=0),$("#all-links").length>0||$(".edit-links").length>0){var desc,link,res=(desc=$(this).find(".instructions").val())+(link=appendLinks($("#link-resources")));notes=$(this).find(".instructions").val(res).val()}else notes=$(this).find(".instructions").val();extra=min+"-"+max,"new"==$("#mode").val()?(mResources=getRecursivelyResources($("#tree-write-selector > ul")),title=$("#writeTitle").val()):(mResources=getRecursivelyResources($("#tree-write-selector-edit > ul")),title=$("#edit-title").val())}else if("discussion"==dataType){if($("#all-links-discussion").length>0||$(".edit-links-discussion").length>0){var desc,link,res=(desc=$(this).find(".description").val())+(link=appendLinks($("#link-resources-discussion")));notes=$(this).find(".description").val(res).val()}else notes=$(this).find(".description").val();"new"==$("#mode").val()?(mResources=getRecursivelyResources($("#tree-discussion-selector > ul")),title=$("#discussion-title").val()):(mResources=getRecursivelyResources($("#tree-discussion-selector-edit > ul")),title=$("#edit-title").val())}else{title=$(this).find("strong.title").text(),notes=$("#global-in-page-instructions").val().length>0?$("#global-in-page-instructions").val():$(this).find(".instructions").val();var examMinutes=$(this).find(".exam_mode_minutes").val();if($.isNumeric(examMinutes)&&(examTime=examMinutes),"in-page-combined-task"==dataType){var checkRequireds=[];$(this).find(".combined-task-required > input").each((function(){$(this).is(":checked")&&checkRequireds.push($(this).attr("class"))})),checkRequireds.length<2&&("quiz-task-combined"===checkRequireds[0]&&($(this).data("combined-required","quiz-page"),extra["combined-required"]="quiz-page"),"written-task-combined"===checkRequireds[0]&&($(this).data("combined-required","short-answer"),extra["combined-required"]="short-answer"))}$(this).find("td.score-answers-container input:checked").length&&(seeScoreAnswers=$(this).find("td.score-answers-container input:checked").data("opt")),["quiz-page","short-answer"].includes(dataType)&&!$(this).find(".task-required > input").is(":checked")&&$(this).attr("data-type","read"),["quiz-page","in-page-combined-task","written-answer"].includes(dataType)&&$(this).data("dynamic-quiz")&&(extra["dynamic-question-ids"]="new")}var examMinutes=$(this).find(".exam_mode_minutes").val();$.isNumeric(examMinutes)&&(examTime=examMinutes),resources.push({id:$(this).data("id"),type:dataType,notes:notes,extra:extra,title:title,resources:mResources,discussion_type:null,examTime:examTime,custom_deadline:customDeadline,see_score_answers:seeScoreAnswers}),"written-answer"==dataType&&(resources[resourcePos]["see-answers"]=$(this).find("input.see-answers").is(":checked"),resources[resourcePos]["see-w-solutions"]=$(this).find("input.see-w-solutions").is(":checked")),resourcePos++}));var page="pages/std-access/std-assignments.php?action=save-assignment",data={ticket:$("#ticket").val(),task_id:$("#edit-task-id").val(),deadline:$("#deadline-date-hidden").val(),general_id:$("#general-id, #gid").val(),sitename:$("#sitename").val(),and_send:andSend,groups:selectedRecipients.groups,students:selectedRecipients.students,resources:resources};$.post(page,data,(function(response){if("1"==response.success){$("#modal-assignment-wizard").modal("hide");var blurb=andSend?"sent to your students":"saved";if($(".std-assignment-send-msg").html(['<div class="alert alert-success" style="margin-bottom: 10px; margin-top: 10px;">','<i class="fa fa-check-circle-o"></i> ',"<strong>Task successfully "+blurb+".</strong>","</div>"].join("")).show("fast").delay(5e3).hide("slow"),$("#qbank-sent-as-task").length){var msg=andSend?"qbank_quiz_sent":"qbank_quiz_draft";sessionStorage.setItem(msg,!0),window.location=`${sitename}/std-access/qbank`}else{var listsToLoad=["active"];"student"!=mode&&listsToLoad.push("pending"),refreshTasksList(mode,id,listsToLoad)}andSend?$('a[href="#active-tab"]').trigger("click"):$('a[href="#pending-tab"]').trigger("click")}else"0"==response.success&&alert(response.msg)}),"json")}function pagePreview(response){var h=$(window).height()-150;h<300&&(h=$(window).height());var w=$(window).width()-100;w>1170&&(w=1200),w<720&&(w=$(window).width());var l,windowSettings="height="+h+", width="+w+", left="+w/4+", top=100, resizable=yes, ";windowSettings+="scrollbars=yes, toolbar=no, menubar=no, location=no, ",windowSettings+="directories=no, status=yes";var url="pages/std-access/task-page-viewer.php";$("form.hidden").remove();var previewForm=document.createElement("form");previewForm.className="hidden",previewForm.target="Preview",previewForm.method="post",previewForm.action=url;var i1=document.createElement("input");i1.type="text",i1.name="ticket",i1.value=$("#ticket").val();var i2=document.createElement("input");i2.type="text",i2.name="type",i2.value="section";var i3=document.createElement("input");i3.type="text",i3.name="title",i3.value=response.title;var i4=document.createElement("textarea");i4.name="content",i4.value=response.body;var i5=document.createElement("textarea");i5.name="breadcrumbs",i5.value="undefined";var i6=document.createElement("input");i6.type="text",i6.name="sitename",i6.value=$("#sitename").val(),previewForm.appendChild(i1),previewForm.appendChild(i2),previewForm.appendChild(i3),previewForm.appendChild(i4),previewForm.appendChild(i5),previewForm.appendChild(i6),document.body.appendChild(previewForm),preview=window.open("","Preview",windowSettings),preview?previewForm.submit():alert("You must allow popups for this preview to work.")}function setUpExamMode(){$("#resources-container").on("click",".exam_mode",(function(){var checkbox=$(this);checkbox.is(":checked")?(disableNextBtn(5),checkbox.parent().next().show(),checkbox.parent().next().children(":first").prop("required",!0)):(enableNextBtn(5),checkbox.parent().next().hide(),checkbox.parent().next().children(":first").prop("required",!1),checkbox.parent().next().children(":first").val(""))})),$("#resources-container").on("change",".exam_mode_minutes",(function(){toggleOnExamChange($(this)),checkEmptyExamMinutes()})),$("#resources-container").on("keyup",".exam_mode_minutes",(function(){toggleOnExamChange($(this)),checkEmptyExamMinutes()}))}function checkRequiredCombinedTasks(){var combinedIconGlobal="";$(document).on("change",".combined-task-required > input",(function(){""===combinedIconGlobal&&(combinedIconGlobal=$(this).closest("td.data").find("span.icon").html());var combinedTaskRequired,totalRequiredChecked=$(this).closest("td.data").find(".combined-task-required").find('input[type="checkbox"]').filter(":checked").length;0===totalRequiredChecked?($(this).closest("td.data").find("span.icon").html('<i class="fa fa-file fixwidth colored"></i>'),$(this).closest("td.data").attr("data-type","read"),$(this).closest("td.data").find(".score-answers-container").addClass("disabled"),$(this).closest("td.data").find('.score-answers-container input[data-opt="0"]').prop("checked",!0),$(this).closest("td.data").find(".score-answers-container input").each((function(){$(this).prop("disabled",!0)})),$(this).closest("td.data").find(".exam-mode-container .exam_mode_minutes").val(""),$(this).closest("td.data").find(".exam-mode-container .exam_mode_minutes").attr("disabled",!0),$(this).closest("td.data").find(".exam-mode-container .exam_mode_minutes label").css("color","#ddd"),$(this).closest("td.data").find(".exam-mode-container .exam_mode_minutes .add-on > i").css("color","#ddd")):($(this).closest("td.data").find("span.icon").html(combinedIconGlobal),$(this).closest("td.data").attr("data-type","in-page-combined-task"),$(this).closest("td.data").find(".exam-mode-container .exam_mode_minutes").attr("disabled",!1),$(this).closest("td.data").find(".exam-mode-container .exam_mode_minutes label").css("color","#242424"),$(this).closest("td.data").find(".exam-mode-container .exam_mode_minutes .add-on > i").css("color","#242424"),updateScoreAnswersMode($(this),totalRequiredChecked)),updateBasket("quiz")}))}function updateScoreAnswersMode(selected,nChecked){var taskChecked=selected.closest(".combined-tasks-edit").find("input:checked"),scoreAnswersContainer=selected.closest("table.more-options").find(".score-answers-container"),dataContainer,id=selected.closest("td.data").data("id");return 0!=nChecked&&(scoreAnswersContainer.removeClass("disabled"),2==nChecked?(scoreAnswersContainer.html(printQuizScoreAnswersOptions(id,!0)),!1):void("quiz-task-combined"==taskChecked.attr("class")?scoreAnswersContainer.html(printQuizScoreAnswersOptions(id,!1)):scoreAnswersContainer.html(printWrittenScoreAnswersOptions(id))))}function checkEmptyExamMinutes(){$(".exam_mode_minutes").each((function(){!$(this).parent().prev().children(":first").is(":checked")||""!=$(this).val()&&0!=$(this).val()||disableNextBtn(5)}))}function toggleOnExamChange(element){if(element.parent().prev().children(":first").is(":checked")){var minutes=element.val(),max=element.prop("max");minutes>0&&minutes<=parseInt(max)||""!=minutes?enableNextBtn(5):disableNextBtn(5)}}function propagationInPageTasks(){$('#tree-site-page-selector input[type="checkbox"]').change((function(){var id=$(this).val();$("#check-"+id).click()}))}function selectInPageTasks(){$('#tree-read-selector input[type="checkbox"]').change((function(){var id=$(this).val(),name=$(this).closest("label").clone().find("a.page-preview").remove().end().text(),tcheckbox="read",readChecked=$(this).is(":checked"),extraData=$(this).data("dynamic-quiz")?' data-dynamic-quiz="true" ':"";""==name&&(name=$(".std-task-name").text()),$("#tree-site-page-selector").find("input[value="+id+'][type="checkbox"]').prop("checked",readChecked),$(this).data("is-quiz-page")&&"no"===$(this).data("is-manual-task")&&(tcheckbox="quiz-page"),"yes"!==$(this).data("is-manual-task")||$(this).data("is-quiz-page")||(tcheckbox="short-answer"),$(this).data("written-answer")&&(tcheckbox="written-answer"),$(this).data("is-quiz-page")&&"yes"===$(this).data("is-manual-task")&&(tcheckbox="in-page-combined-task"),readChecked?(appendResource(id,name,tcheckbox,extraData),updateStage2Btn()):$.when($("#resources-container").find("li."+tcheckbox+"-"+id).remove()).then(updateStage2Btn()),updateBasket(tcheckbox)}))}function selectQuizzesResources(mode=""){$('#qbank-checks input[type="checkbox"], #editor-qbank-checks input[type="checkbox"]').change((function(){var id=$(this).val(),name=$(this).closest("label").find("span").text();if($(this).is(":checked")){var quizType="quiz";$(this).hasClass("written-answer")?quizType="written-answer":$(this).hasClass("model-answer")&&(quizType="model-answer"),$.when(appendResource(id,name,quizType)).then(updateStage2Btn()),""==mode&&($("#resources-container").find("td.data i.remove-task").hide(),$("#resources-container").find(".set-custom-deadline").hide())}else $.when($("#resources-container").find("li.quiz-"+id+", li.written-answer-"+id).remove(),$("#resources-container").find("li.quiz-"+id+", li.model-answer-"+id).remove()).then(updateStage2Btn());updateBasket("qbank")}))}function updateBasket(type){var selected=0;"qbank"!==type?setBasketCounter(selected=getInPageTasksChecked(),"#pages-tab-link"):setBasketCounter(selected=$("#quizzes-tab").find('input[type="checkbox"]:checked').length,"#quizzes-tab-link")}function setBasketCounter(selected,tab){$(tab).find("span.basket-counter").text(selected>0?`(${selected})`:""),updateTotalBasket()}function getInPageTasksChecked(){var singleInPageTaskChecked=getDataIsCombinedTask("no"),combinedInPageTaskChecked=0;return $(".combined-tasks-edit").each((function(){var quizChecked=$(this).find("input[class='quiz-task-combined'][type='checkbox']:checked").length,writtenChecked=$(this).find("input[class='written-task-combined'][type='checkbox']:checked").length;combinedInPageTaskChecked=combinedInPageTaskChecked+quizChecked+writtenChecked,0===quizChecked&&0===writtenChecked&&(combinedInPageTaskChecked+=1)})),singleInPageTaskChecked+combinedInPageTaskChecked}function getDataIsCombinedTask(isCombinedTask){return $("#tree-site-page-selector").find('input[data-is-combined-task="'+isCombinedTask+'"][type="checkbox"]:checked').length}function updateTotalBasket(){var total=0;$("span.basket-counter").each((function(){var nTasks=$(this).text().replace(/[^0-9]/gi,""),currentNum=""!=nTasks?parseInt(nTasks):0;total+=currentNum}));var tasksChosen=0==total||total>1?" tasks selected":" task selected";$("span.basket-total-tasks").text(total+tasksChosen)}function checkResources(){$("#pages-tab-link, #quizzes-tab-link").click((function(){$("#to-stage-2").data("alert","Select at least one resource to continue")})),$("#discussion-tab-link, #write-tab-link").click((function(){$("#to-stage-2").data("alert","Select at least a title to continue")}))}function fixUnselectedAssignments(){$("#to-stage-2").click((function(){if($("#link-instructions").val().length>0||$("#add-link-description").val().length>0)return $("#to-stage-2").data("alert",'Click the "Add" button in order to add an external link'),!1;""==$("#writeTitle").val()&&$("#resources-container li.write-0").remove(),""==$("#discussion-title").val()&&$("#resources-container li.discussion-0").remove()}))}function searchQuizzes(el,kwType,elList,mode){var wordss=el.val().toLowerCase(),list=elList;if(wordss.length>3){for(null==mode?list.find("li").hide():list.children("li").hide(),i=0;i<kwType.length;i++){var data=kwType[i];if(data.words.indexOf(wordss)>=0){var listId=data.id;list.find("#"+listId).show()}}list.find("li.not-found").toggle(!list.find("li:visible").not(".not-found").length)}else list.find('li:not(".not-found")').show(),list.find("li.not-found").hide()}function getClosestPagerNum(n){var showPerPage=10;switch(n){case n<=10:showPerPage=10;break;case n>10&&n<=25:showPerPage=25;break;case n>25&&n<=50:showPerPage=50;break;case n>50:showPerPage=100}return showPerPage}function showModalStudents(){$("#assignments-tab,\n        #active-assignments-container,\n        #pending-assignments-container,\n        #awaiting-assignments-container,\n        #overdue-assignments-container,\n        #completed-assignments-container").on("click",".show-students",(function(e){var title,list;e.preventDefault(),showStudentsList($(this).text(),$(this).data("ids"))}))}function showStudentsList(title,list){$("#modal-show-students .modal-header h3").html(title);var body="<em>There are no students in this group.</em>",stds=[];for(i=0;i<list.length;i++)individualStudents.hasOwnProperty(list[i])&&stds.push(individualStudents[list[i]]);stds.sort(),stds.length>0&&(body="<ol><li>",body+=stds.join("</li><li>"),body+="</li></ol>"),$("#modal-show-students .modal-body").html(body),$("#modal-show-students").modal("show")}function newAssignment(mode){$("#new-assignment").click((function(e){e.preventDefault(),$("#mode").val("new"),resetAssignmentsModal(mode),$("#modal-assignment-wizard").modal("show")}))}function resetFilters(){$("#content").on("click",".reset-filters",(function(e){e.preventDefault();var status=$(this).data("status");$("#typeahead-"+status).closest(".dropdown").children("a").html('Filter by type of task <b class="caret"></b>'),$("table."+status+" > tbody > tr").removeClass("filtered").removeClass("filtered-task"),$(".pager-"+status).find("a").eq(0).trigger("click")}))}function toStage4(){$("#to-stage-4").click((function(e){if($("#global-in-page-instructions").val().length>0&&$(".in-page-instructions").val($("#global-in-page-instructions").val()),$("#resources-container").find("textarea.instructions, textarea.description").each((function(){var instructions=$(this),height=instructions.get(0).scrollHeight;instructions.css("height",height+"px")})),$(".write-resources").empty(),$(".discussion-resources").empty(),$("#resources-container").find("li.write-0").length>0&&$("p#link-resources").find("li").length>0){var links=$("p#link-resources").find("ul#all-links, ul.edit-links").removeAttr("id").addClass("edit-links").clone(),content="",writeResources;links.each((function(){var l=$(this);content+=l.get(0).outerHTML})),$('#resources-container td.data[data-type="write"]').find(".write-resources").html(['<div class="row-fluid">','<label style="font-size: 14px;">Resources</label>',content,"</div>"].join(""))}if($("#resources-container").find("li.discussion-0").length>0&&$("p#link-resources-discussion").find("li").length>0){var links=$("p#link-resources-discussion").find("ul#all-links-discussion, ul.edit-links-discussion").removeAttr("id").addClass("edit-links-discussion").clone(),content="",discussionResources;links.each((function(){var l=$(this);content+=l.get(0).outerHTML})),$('#resources-container td.data[data-type="discussion"]').find(".discussion-resources").html(['<div class="row-fluid">','<label style="font-size: 14px;">Resources</label>',content,"</div>"].join(""))}var nTasks;cleanUpEmptyResources(),$("#resources-container").find("td.data").length>1?$("span.stage-4-this-task").text("each"):($("span.stage-4-this-task").text("this"),$("span.drag-drop-stage-4").html(""))}))}function cleanUpEmptyResources(){$("#resources-container").find("ul#all-links, ul.edit-links").each((function(){var rList=$(this);rList.children().length||rList.remove()}))}function selectRecipentsGroups(){$(".groups-container input").change((function(){var groupId=$(this).val(),modal=$(this).closest(".modal"),studentSelectors=modal.find(".students-container input.group-"+groupId);if(studentSelectors.prop("checked",$(this).is(":checked")),$(this).is(":checked"))studentSelectors.parent("label").addClass("selected"),modal.find(".students-container label.selected").length||$("#modal-assignment-wizard .students-container").parent().hide();else{var checkedGroups=[];modal.find('.groups-container input[type="checkbox"]:checked').each((function(){checkedGroups.push($(this).val())})),modal.find('.students-container input[type="checkbox"]').each((function(){var stdSelector=$(this);$.each(checkedGroups,(function(i,groupId){stdSelector.hasClass("group-"+groupId)?(stdSelector.prop("checked",!0),stdSelector.parent("label").addClass("selected")):(stdSelector.prop("checked",!1),stdSelector.parent("label").removeClass("selected"))}))})),modal.find(".students-container label.selected").length||$("#modal-assignment-wizard .students-container").parent().show()}var allStudents=modal.find(".students-container label.checkbox"),selectedStudents;0==modal.find(".students-container label.selected").length&&allStudents.removeClass("filtered-student"),updateStage3Btn()}))}function stickSelectDateContainer(element){element.on("scroll",(function(e){if(e.preventDefault(),$("#task-select-date").is(":visible")){var selectDateOffset=$("#task-select-date").offset().top+$("#task-select-date").height(),resourcesContainerOffset;$("#resources-container").offset().top<selectDateOffset?$("#task-select-date").css({"padding-top":"15px","padding-bottom":"15px"}):$("#task-select-date").css({"padding-top":"0","padding-bottom":"0"})}}))}function searchStudents(){$("#modal-assignment-wizard, #modal-update-recipients").on("keyup","#typeahead-students",(function(){var search=$(this).val().toLowerCase();search.length>=3?($(".students-container > label > input").parent().addClass("filtered-search"),$(".students-container > label > input").each((function(){var student;$(this).parent().text().toLowerCase().indexOf(search)>=0&&$(this).parent().removeClass("filtered-search")}))):$(".students-container > label > input").parent().removeClass("filtered-search")}))}function shareDraftPageLink(){$("#assignments-tab").on("click","a.share-link",(function(e){if(e.preventDefault(),$(this).hasClass("disabled"))return!1;var resource=$(this).data("resource"),groups=$(this).data("groups").toString().split(","),linkModal=$("#std-access-share-link"),linksContainer=linkModal.find(".std-links-url"),groupNames=[];$(this).closest("tr").find("td.students span.group").each((function(){groupNames.push($(this).text())})),linkModal.modal("show"),linkModal.on("shown.bs.modal",(function(){linksContainer.html(""),$.each(groups,(function(i,group){var hr=groups.length>1&&i+1!=groups.length?"<hr>":"",html='<div style="margin: 10px 0;"><p><strong>'+groupNames[i]+'</strong></p><div><code class="activation-url" style="margin: 10px 0;">'+resource+"/?lg="+group+'</code><button class="btn btn-small btn-default copy-std-link-url" style="margin-left: 10px;" title="Copy URL to clipboard"><i class="fa fa-link"></i> Copy URL</button></div></div>'+hr;linksContainer.append(html)}))}))})),$("#std-access-share-link").on("click","button.copy-std-link-url",(function(e){e.preventDefault();var copyBtn=$(this),url=copyBtn.prev("code").text(),textField=document.createElement("textarea");textField.innerText=url,this.parentNode.insertBefore(textField,this),textField.select(),document.execCommand("copy"),textField.parentNode.removeChild(textField);var prevHtml=copyBtn.html();copyBtn.html('<i class="fa fa-check colored"></i> Copied!'),setTimeout((function(){copyBtn.html(prevHtml)}),3e3)}))}function selectRecipentsStudents(){$("#modal-assignment-wizard .students-container label.checkbox input").change((function(){$.when($(this).parent("label").toggleClass("selected")).then(updateStage3Btn())}))}function showHideWrittenTaskModal(element){element.on("shown",(function(){element.css({width:.8*$(window).width()+"px","margin-left":"-"+.8*$(window).width()/2+"px"}),element.find(".modal-body").css("max-height","calc(100vh - "+.2*$(window).height()+"px)"),element.find(".modal-body, .modal-footer").css("overflow-y","auto"),element.find(".modal-footer").css("max-height",.2*$(window).height()+"px"),setModalGradeSystem(),initInlineCommentBox(element.find("#modal-write-std-answer"))}));var answerContainer=element.find("#modal-write-std-answer"),originalY=answerContainer.offset().top;answerContainer.css("position","relative"),element.find(".std-response").on("scroll",(function(){var scrollTop=$(this).scrollTop();answerContainer.stop(!1,!1).animate({top:scrollTop<originalY?0:scrollTop-originalY},150)})),element.on("hidden",(function(){$(".inline-comment-box").remove(),enableEventsOnModalWrittenTaskReport(),reloadLocation&&location.reload()})),$("body").on("click",(function(e){}))}function addComments(element){element.on("mouseup","#modal-write-std-answer",(function(e){e.preventDefault();var selection=selectedTextListener(),correctSelectedTarget=getSelectedTextByElements([".std-manual-answer",".custom-essay"]);hasErrors=!1,correctSelectedTarget&&""!==selection.toString()&&initCommentListener(e)}))}function getSelectedTextByElements(elements){let selectors=elements.join(",");const fNode=window.getSelection().focusNode;return null!==fNode&&null!==fNode.parentElement.closest(selectors)}function selectedTextListener(){let selection;return window.getSelection?selection=window.getSelection():document.selection&&(selection=document.selection.createRange()),selection}function enableDisableSaveBtn(element){element.on("keyup","textarea#student-msg",(function(e){var comment=$(this).val();$("#modal-write-save, #modal-write-send").attr("disabled",!comment.trim().length)})),element.on("keyup change","#modal-write-score-percentage",(function(e){var percentage=$(this).val();$("#modal-write-save, #modal-write-send").attr("disabled",!percentage.trim().length)})),element.on("keyup change","#modal-write-score-points1, modal-write-score-points2",(function(e){var points=$(this).val();$("#modal-write-save, #modal-write-send").attr("disabled",!points.trim().length)})),element.on("keyup","#modal-write-teacher-notes",(function(e){e.preventDefault(),$("#modal-write-save-private-notes").attr("disabled",!1),$("#modal-write-details .modal-body").animate({scrollTop:1e4},"slow")}))}function saveTaskGradesComments(element){element.click((function(e){e.preventDefault(),$.when(saveThread($("textarea#student-msg")),saveGrade($(".write-std-grading"))).then($("#modal-write-save").attr("disabled",!0),updateStdTaskTable(!1))}))}function sendTaskGradesComments(element){sendTaskGradesBinded||(sendTaskGradesBinded=!0,element.click((function(e){e.preventDefault(),$.when(saveSendInlineComment(!0),sendThreads($("#threads")),sendGrade($(".write-std-grading"))).then(updateStdTaskTable(!0))})))}function deleteThread(){$("#modal-write-details").on("click","a.delete-thread",(function(e){e.preventDefault();var id=$(this).data("thread-id");confirm("You are about to remove a teacher comment.\n\nPlease confirm")&&deleteThreadComment(id)}))}function savePrivateNotes(element){element.click((function(e){e.preventDefault(),saveTeacherPrivateNotes()}))}function editQuizScore(element){element.on("click","#change-quiz-score",(function(e){e.preventDefault();var quizModal=$(this).closest(".modal-body"),td=quizModal.find("span.score-editable").parent("td"),prevScore=quizModal.find("span.score-editable").text(),first=prevScore.split("/")[0].trim(),second=prevScore.split("/")[1].match(/\d+/)[0].trim();$(".teacher-comments").show("fast"),td.html(`\n            <div class="form-horizontal input-score">\n                <input id="score-num" value="${first}" type="number" min="0" max="${second}" step="1" style="width: 40px;">\n                <span>/</span>\n                <input id="score-den" value="${second}" type="number" max="${second}" step="1" style="width: 40px;" disabled>\n            </div>\n        `)})),element.on("click","#send-quiz-teacher-comments",(function(e){e.preventDefault();var quizModal=$(this).closest(".modal-body"),num=quizModal.find("#score-num").val(),den=quizModal.find("#score-den").val(),comments=quizModal.find("#quiz-teacher-comments").val();if(parseInt(num)>parseInt(den)||!isValidInput(num))return alert("Score is not well formatted"),!1;saveAndSendScore(num,den,comments)})),element.on("click","button.cancel",(function(e){e.preventDefault();var quizModal=$(this).closest(".modal");quizModal.find(".teacher-comments").hide("fast");var score=calculateNewScore(quizModal.find('input[name="saved-score"]').val());$("div.input-score").parent("td").html(`\n            <span class="score-editable">${score}</span>\n            <a href="#" id="change-quiz-score">\n                <i class="fa fa-edit fa-lg" title="Edit score" style="margin-left: 5px;"></i>\n            </a>\n        `)}))}function initNextTaskListener(container,mode){container.on("click","#go-to-next-task, #go-to-previous-task",(function(e){var gradeStatus="",index=stdList.indexOf(currentStd);if(index>=0&&index<stdList.length){var nextIndex=index+1,prevIndex=index-1,nextStd=null;if(nextStd=$(e.target).hasClass("next")?nextIndex<stdList.length?stdList[nextIndex]:stdList[0]:prevIndex>=0?stdList[prevIndex]:stdList[stdList.length-1],mode=$("#gradebook").is(":visible")?"group":"report",$.inArray(nextStd,stdCompletedList)<0){if("group"==mode){var gradeBookIndex=$("#students-scrollable-table").find('thead th.rotated[data-task="'+taskId+'"]').index(),tr;gradeStatus=(tr=$("#students-scrollable-table").find('tbody tr[data-student="'+nextStd+'"]')).find("td").eq(gradeBookIndex).data("status")}"report"==mode&&(gradeStatus=$("#log-table").find('tbody > tr[id="task-write-'+nextStd+'"]').data("grade-status"))}var stdTaskId,task,nextStdName="",tr,tr;if("group"==mode)nextStdName=(tr=$("#students-scrollable-table").find('tbody > tr[data-student="'+nextStd+'"]')).find("td").first().find('a[data-toggle="dropdown"]').text(),stdTaskId=taskId,task=taskType,currentStd=nextStd;if("report"==mode)nextStdName=(tr=$("#log-table").find('tbody > tr[id="task-write-'+nextStd+'"]')).find("td.name").clone().children().remove('a[href*="@"]').end().text(),task=$("#log-table").find("tbody > tr").first().data("task-type"),currentStd=nextStd,stdTaskId=visitsLog[nextStd].std_task_id,nextStd=visitsLog[nextStd].log;$.when(resetModalReview()).then(loadTaskReview(stdTaskId,nextStd,mode,task,nextStdName,gradeStatus))}}))}function isValidInput(input){if(!(input=input.trim()))return!1;input=input.replace(/^0+/,"")||"0";var n=Math.floor(Number(input));return n!==1/0&&String(n)===input&&n>=0}function calculateNewScore(score){var first=score.split("/")[0].trim(),second=score.split("/")[1].trim();return first+"/"+second+" ("+Math.round(first/second*100)+"%)"}function saveAndSendScore(num,den,comments){var stdId=$('input[name="std-id"]').val(),taskId=$('input[name="task-id"]').val(),thread=comments.length?comments:"Score updated",mark=num+"/"+den,page="/pages/std-access/std-assignments-report-actions.php",data={action:"edit-quiz-score",ticket:$("#ticket").val(),"std-id":stdId,"task-id":taskId,mark:mark,thread:thread};$.post(page,data,(function(response){if("1"==response.success){if($("div.input-score").parent("td").html(`\n                <span class="score-editable">${response.mark} (${response.score}%)</span>\n                <a href="#" id="change-quiz-score">\n                    <i class="fa fa-edit fa-lg" title="Edit score" style="margin-left: 5px;"></i>\n                </a>\n            `),$('input[name="saved-score"]').val(response.mark),$("#quiz-teacher-comments").val(thread),$(".teacher-comments").hide("fast"),$(".edit-msgs").html(['<div class="alert alert-success">','<i class="fa fa-check-circle-o"></i> ',"<strong>Score successfully edited.</strong>","</div>"].join("")).show("fast").delay(5e3).hide("slow"),$("#students-scrollable-table").length){var th=$("#students-scrollable-table > thead").find('th[data-task="'+$('input[name="task-id"]').val()+'"]'),tr;$("#students-scrollable-table > tbody").find('tr[data-student="'+$('input[name="std-id"]').val()+'"]').find("td").eq(th.index()).html(['<div class="">',response.mark,'<ul class="float-menu" style="display: block;">','<li><a class="open-task-report" href="#"><i class="fa fa-fw fa-bar-chart"></i> ',"Open task report</a>","</li>",'<li><a class="reset-task-student" href="#"><i class="fa fa-fw fa-undo"></i> ',"Reset task for the student</a>","</li>","</ul>","</div>"].join(""))}if($("#log-table").length){var quizHistory=$("#log-table").find('tr[data-std-id="'+stdId+'"] > td.score > a');$("#log-table").find('tr[data-std-id="'+stdId+'"] > td.score').html(['<a class="show-quiz-history" href="#" title="Open student task report" ','data-std-id="'+stdId+'" ','data-std-name="'+quizHistory.data("std-name")+'" ','data-status="'+quizHistory.data("status")+'" ','data-std-email="'+quizHistory.data("std-email")+'">',"<strong>"+num+"</strong>","<small>/"+den+" ("+response.score+"%)</small>","</a>"].join("")),visitsLog[stdId][0].mark=response.mark,visitsLog[stdId][0].score=response.score,threads[stdId]=thread}$("#student-panes").length&&$("#student-panes").find('table tr[data-task="'+taskId+'"] > td.score').html(['<a class="std-task-action load-std-report" href="#" title="Open student task report">',"<strong>"+num+"</strong>","<small>/"+den+" ("+response.score+"%)</small>","</a>"].join(""))}else"0"==response.success&&alert(response.msg)}),"json")}function setModalGradeSystem(){if(0===$("#modal-mark-score").val().length?($("#modal-select-score-type").val("percentage").change(),$("#modal-write-score-percentage").val($("#modal-write-score").val())):($("#modal-select-score-type").val("points").change(),$("#modal-write-score-points1").val($("#modal-mark-score").val().split("/")[0]),$("#modal-write-score-points2").val($("#modal-mark-score").val().split("/")[1])),0!=$("#modal-grade-system").val().length){var disabled="",selected="";"mark"==$("#modal-grade-system").val()?(disabled="percentage",selected="points"):(disabled="points",selected="percentage"),$("#modal-select-score-type").val(selected).change(),$("#modal-select-score-type").attr("disabled",!0),$('#modal-select-score-type option[value="'+disabled+'"]').attr("disabled",!0),"mark"==$("#modal-grade-system").val()&&0!=$("#modal-mark-denominator").val().length&&($("#modal-write-score-points1").val($("#modal-mark-score").val().split("/")[0]),$("#modal-write-score-points2").val(0!=$("#modal-mark-denominator").val().length?$("#modal-mark-denominator").val():$("#modal-mark-score").val().split("/")[1]),$("#modal-write-score-points2").attr("disabled",!0)),"score"==$("#modal-grade-system").val()&&0!=$("#modal-write-score").val().length&&$("#modal-write-score-percentage").val($("#modal-write-score").val())}}function selectScoreType(element){element.on("change",(function(){"percentage"===$(this).val()?$("#toggle-grade").html('                 <input id="modal-write-score-percentage" value="" type="number" min="0" max="100" step="1" style="margin-bottom: 0; width: 4em;">                 <span style="font-size: 1.5em; font-weight: bold;">&nbsp;%</span>             '):$("#toggle-grade").html('                 <input id="modal-write-score-points1" value="" type="number" min="0" max="25" step="1" style="margin-bottom: 0; width: 3.3em;">                 <span style="font-size: 1.5em; font-weight: bold; margin: 0 5px;"> / </span>                 <input id="modal-write-score-points2" value="" type="number" min="0" max="25" step="1" style="margin-bottom: 0; width: 3.3em;">             ')}))}function resetModalReview(){$("#modal-write-title").empty(),$("#modal-write-std-details").empty(),$("#modal-write-std-answer").empty(),$("#modal-write-std-task").empty(),$("#modal-task-type").val(""),$("#modal-makr-score").val(""),$("#modal-write-score").val(""),$("i.sent-mark").hide(),$(".comment-box-msg").hide(),$("#modal-write-save").parent("div").addClass("btn-group"),$("#modal-write-save").show(),$("#modal-write-save, #modal-write-send").attr("disabled",!0),$("#modal-write-save-private-notes").attr("disabled",!0),$("#write-teacher-notes").empty(),$("#modal-write-std").val(""),$("#modal-write-std-log").val(""),$("#modal-write-comment-box").empty(),$("#modal-write-score-points1").val(""),$("#modal-write-score-points2").val(""),$("#modal-write-score-percentage").val(""),$("#modal-write-score-points2").attr("disabled",!1),$("#modal-select-score-type").attr("disabled",!1),$("#modal-select-score-type option").attr("disabled",!1),$("#modal-select-score-type option").attr("selected",!1)}sendTaskGradesBinded=!1;{function resetStudentTask(student,task,type,element,group="",dedicated=!1,combinedTaskInfo={}){element.find("i.reset-std-task").toggleClass("fa-undo fa-circle-o-notch fa-spin");var gradebook="td"==element.prop("tagName").toLowerCase(),url="/pages/std-access/std-assignments-report-actions.php",data={ticket:$("#ticket").val(),action:"reset-student-task",group:group,student:student,task:task,gradebook:gradebook};$.post(url,data,(function(response){if(1==response.success){if(dedicated&&location.reload(),gradebook){if("custom"==type)var href,lines,cellContent=["<div>",'<i title="Awaiting teacher grade" class="text-success fa fa-check" style="font-size: .8em;color:gray;"></i>','<ul class="float-menu">','<li><a class="update-custom-assignment" href="'+("/"+$("#sitename").val()+"/std-access/custom-assignment/"+group+"-"+task)+'">','<i class="fa fa-fw fa-edit"></i> Edit task',"</a></li>","</ul>","</div>"].join("");else cellContent='<div><i class="gray fa fa-minus"></i></div>',element.attr("title","Pending task");void 0!==combinedTaskInfo.combinedTaskId&&1===combinedTaskInfo.isExam?element.parent().find('td[data-combined-task-id="'+combinedTaskInfo.combinedTaskId+'"]').html(cellContent):element.html(cellContent)}else if(element.find("td").css("color",""),element.find("td:not(:first)").html("&mdash;"),element.attr("data-grade-status","pending"),element.data("grade-status","pending"),visitsLog[student].log="",response.overdue){var markAsZeroCell="";$.inArray(type,["short-answer","write"])>=0&&(markAsZeroCell=['<li data-std-task-id="'+response["std-task-id"]+'">','<a class="grade-as-zero" href="#">',"Grade as zero","</a>","</li>"].join(""));var unflagCell=$(`\n                        <div class="menu">\n                            <i class="fa fa-flag red overdue"></i>\n                            <ul class="float-menu" style="display: none;">\n                                <li data-std-task-id="${response["std-task-id"]}">\n                                    <a class="unflag-assignment" href="#">Remove overdue flag</a>\n                                </li>\n                                ${markAsZeroCell}\n                            </ul>\n                        </div>\n                    `);element.find("td.score").html(unflagCell),element.attr("data-grade-status","overdue"),element.data("grade-status","overdue")}}else 0==response.success&&"string"==typeof response.msg&&(element.find("i.fa-circle-o-notch").removeClass("fa-spin").toggleClass("fa-circle-o-notch fa-undo"),alert(response.msg))}),"json")}function forgiveTask(stdTaskId,taskId,element){var requester=$("#modal-write-requester").val(),data={action:"forgive-task","std-task-id":stdTaskId,"task-id":taskId,ticket:$("#ticket").val()},url="/pages/std-access/std-assignments-report-actions.php";$.post(url,data,(function(response){1==response.success?"dedicated-student"==requester?location.reload():element.html('<small class="gray" title="Not required">NR</small>'):alert(response.msg)}),"json")}function gradeTaskAsZero(stdTaskId,taskId,element){var requester=$("#modal-write-requester").val(),data={action:"grade-task-as-zero","std-task-id":stdTaskId,"task-id":taskId,ticket:$("#ticket").val()},url="/pages/std-access/std-assignments-report-actions.php";$.post(url,data,(function(response){1==response.success?"dedicated-student"==requester?location.reload():(visitsLog[response.std_id].log=response.log_id,element.closest("tr").find("td.score").html(response.grade_td),element.closest("tr").find("td.status").html(response.status_td),element.closest("tr").find("td.submit").html(response.submit_td),element.closest("tr").find("td").last().html(response.reset_td)):alert(response.msg)}),"json")}function resetEditTaskDetailsModal(){$("#modal-edit-task-details .modal-header h3 > span").empty(),$("#edit-task-details-id").val(""),$("#edit-task-details-pre").html(""),$("#edit-task-instructions, #edit-task-title").val("").prop("readonly",!1),$(".set-date").datepicker("remove"),setUpDatepicker(),$("#edit-task-min-words").val("").prop("readonly",!0),$("#edit-task-max-words").val("").prop("readonly",!0),$("#edit-task-words").hide(),$("#edit-task-exam-mode").find('input[name="exam-mode"]').prop("checked",!1).prop("readonly",!1),$("#edit-task-exam-mode").find('input[name="exam-time"]').val("").prop("readonly",!1),$("#edit-task-exam-mode").hide(),$("input.input-mini").prop("disabled",!1),$("input.exam_mode").prop("disabled",!1),$("#edit-resource-success").hide(),$("#edit-link-instructions").parent().hide(),$("#edit-all-links").length>0&&$("#edit-all-links").remove(),$("#edit-selector-box").find(".std-nav-tree-collapse-all").trigger("click"),$("#edit-tree-selector").find('input[type="checkbox"]:checked').prop("checked",!1)}function bindTaskPreviewClick(){$("#reports-panel, #student-panes").on("click","a.preview-task",(function(e){e.preventDefault(),e.stopPropagation();var url="quiz"==$(this).data("type")?"/pages/user/qbank-viewer.php?i="+$(this).data("resource_id")+`&s=${tibSitename}&g=`+$(this).data("g"):`/${tibSitename}/page/`+$(this).data("resource_id");window.open(url,"_blank")}))}function loadEditTask(){$(".task-container").on("click","a.edit-task",(function(e){e.preventDefault(),e.stopPropagation();var taskId=$(this).closest("tr").data("task"),combinedTaskId=$(this).closest("tr").data("combined-task-id");$.when(resetEditTaskDetailsModal()).then(loadTaskDetails(taskId,combinedTaskId))}))}function loadTaskDetails(taskId,combinedTaskId=""){var row=$(".task-container").find("tr#task-"+taskId),taskIcon=row.find("td.task span.icon").children(":first");$("#edit-task-details-id").val(taskId);var resource_type=row.find("td.task").data("type");$("#edit-task-type").val(resource_type),$("#edit-task-title").val(row.find("td.task a.std-task-action").text());var notes=row.find("span.assignment-notes").html(),cleanNotes=notes.replace(/<!-- RESOURCES -->.*<!-- END RESOURCES -->/,"");$("#edit-task-instructions").val(cleanNotes);var editResourcesMatches=notes.match(/<!-- RESOURCES -->(.*?)<!-- END RESOURCES -->/);null!=editResourcesMatches&&$(editResourcesMatches[1]).find("p > a").each((function(){var href=$(this).attr("href"),hrefMatches=href.match("https://www.student."+SITE_WEB+"/(.*)/page/([0-9]{1,})");if(null!=hrefMatches){foundPageResource=!0;var pageId=hrefMatches[2];$("#edit-tree-selector").find("#check-"+pageId).each((function(){$(this).prop("checked",!0),$(this).parentsUntil(".toplevel").each((function(){$(this).parent().hasClass("parent")&&$(this).parent().addClass("expanded"),$(this).hasClass("parent")&&$(this).addClass("expanded")})),addPagesLinksByType($(this),$("#edit-link-resources"),"edit-all-links","edit-link-resource")}))}else appendExternalLink("edit-task",href)})),"quiz"!=resource_type&&"quiz-page"!=resource_type||$("#edit-score-answer-options").html(printQuizScoreAnswersOptions(taskId,!1)),"short-answer"==resource_type&&$("#edit-score-answer-options").html(printWrittenScoreAnswersOptions(taskId));var seeScoreAnswers=row.data("score-answers");$("#edit-score-answer-options").length&&$("#edit-score-answer-options").find('input[type="radio"]').each((function(){var radio=$(this);radio.prop("checked",radio.data("opt")==seeScoreAnswers),"pending"!=row.data("status")?(radio.parents("label").css({opacity:"0.5",cursor:"not-allowed"}),radio.prop("disabled",!0)):(radio.parents("label").css({opacity:"1",cursor:"pointer"}),radio.prop("disabled",!1))}));var examMode=!1;switch(resource_type){case"quiz":case"quiz-page":examMode=!0,$("#edit-task-title").prop("readonly",!0);break;case"read":$("#edit-task-title").prop("readonly",!0);break;case"write":examMode=!0;var min_words=row.find("td.task span.words").data("min"),max_words=row.find("td.task span.words").data("max");$("#edit-task-min-words").prop("readonly",!1).val(min_words),$("#edit-task-max-words").prop("readonly",!1).val(max_words),$("#edit-task-words").show(),$("#edit-task-resources").show();break;case"discussion":$("#edit-task-resources").show();break;case"short-answer":examMode=!0,$("#edit-task-title").prop("readonly",!0)}examMode&&("pending"!=row.data("status")&&"active"!=row.data("status")||($("#edit-task-exam-mode").show(),$("#edit-task-exam-mode").find('input[name="exam-time"]').prop("readonly","pending"!=row.data("status")),row.find("td.task span.timed_task").length>0&&$("#edit-task-exam-mode").find('input[name="exam-time"]').val(row.find("td.task span.timed_task").data("time")>0?row.find("td.task span.timed_task").data("time"):""))),row.find("i.fa-spinner").removeClass("fa-spinner").addClass("fa-edit"),$("#modal-edit-task-details .modal-header h3 > span").prepend(taskIcon.clone()).html(),""!=combinedTaskId&&$("#edit-task-exam-mode").hide(),$("#modal-edit-task-details").modal("show")}function saveEditDeadline(){$("#modal-change-deadline").on("click","#save-change-deadline",(function(e){e.preventDefault(),saveNewDeadline()}))}function saveNewDeadline(){var mode=$("#group-id").length>0?"group":"general",groupId=$("#group-id").val(),deadlineDateObject=$("#edit-task-deadline").datepicker("getDate");deadlineDateObject.setHours(23),deadlineDateObject.setMinutes(59),deadlineDateObject.setSeconds(59);var deadlineTimestamp=deadlineDateObject.toISOString(),page="pages/std-access/std-assignments.php?action=update-deadline",data={ticket:$("#ticket").val(),general_id:$("#general-id").val(),task_id:$("#update-deadline-task-id").val(),task_type:$("#update-deadline-task-type").val(),sitename:$("#sitename").val(),task_deadline:deadlineTimestamp};$.post(page,data,(function(response){"1"==response.success?$.when(refreshTasksList(mode,groupId)).then($("#modal-change-deadline").modal("hide"),$("#update-deadline-task-id").val(""),$("#update-deadline-task-type").val(""),$(".set-date").datepicker("remove"),setUpDatepicker(),$(".std-assignment-send-msg").html(['<div class="alert alert-success">','<i class="fa fa-check-circle-o"></i> ',"<strong>Task deadline successfully updated.</strong>","</div>"].join("")).show("fast").delay(5e3).hide("slow")):"0"==response.success&&alert(response.msg)}),"json")}function saveEditTask(){$("#modal-edit-task-details").on("click","#edit-save-task",(function(e){e.preventDefault(),saveTaskDetails()}))}function saveTaskDetails(){var mode="general";if($("#group-id").length>0){var groupId=$("#group-id").val();mode="group"}var taskType=$("#edit-task-type").val(),instructions=$("#edit-task-instructions").val(),links="";$("#edit-all-links").length>0&&(links=appendLinks($("#edit-all-links")));var taskNotes=instructions+links,extra="";if("write"==taskType){var min=$("#edit-task-min-words").val(),max=$("#edit-task-max-words").val();if(""==max||""==min)return void alert("Please enter the minimum and maximum words for this custom essay.");extra=min+"-"+max}var mResources="";"write"!=taskType&&"discussion"!=taskType||(mResources=getRecursivelyResources($("#edit-tree-selector > ul")));var examTime="";if("quiz"==taskType||"quiz-page"==taskType||"short-answer"==taskType||"write"==taskType){var examMinutes=$("#edit-task-exam-mode").find('input[name="exam-time"]').val();if(examMinutes.length){if(!$.isNumeric(examMinutes))return void alert("Please enter a valid exam duration in minutes.");examTime=examMinutes}}var scoreAnswersMode="0";$("#edit-score-answer-options").length&&(scoreAnswersMode=$("#edit-score-answer-options").find("input:checked").data("opt"));var page="pages/std-access/std-assignments.php?action=update-task",data={ticket:$("#ticket").val(),general_id:$("#general-id").val(),task_id:$("#edit-task-details-id").val(),task_type:taskType,task_title:$("#edit-task-title").val(),task_notes:taskNotes,task_extra:extra,task_resources:mResources,task_exam_time:examTime,task_score_answers:scoreAnswersMode};$.post(page,data,(function(response){"1"==response.success?$.when(refreshTasksList(mode,groupId)).then($("#modal-edit-task-details").modal("hide"),resetEditTaskDetailsModal(),$(".std-assignment-send-msg").html(['<div class="alert alert-success">','<i class="fa fa-check-circle-o"></i> ',"<strong>Task details successfully edited.</strong>","</div>"].join("")).show("fast").delay(5e3).hide("slow")):"0"==response.success&&alert(response.msg)}),"json")}function appendLinksEdit(){$("#edit-student-page").click((function(e){e.preventDefault(),$("#edit-resource-success").show(),$("#edit-selector-box").show(),$("#edit-link-instructions").parent().hide()})),$("#edit-external-link").click((function(e){e.preventDefault(),$("#edit-selector-box").hide(),$("#edit-link-instructions").parent().show(),$("#edit-resource-success").show()})),$("#edit-resource-success").click((function(e){$(this).hide(),$("#edit-selector-box").hide(),$("#edit-link-instructions").parent().hide()})),$(document).on("click","#edit-add-link-instructions",(function(){appendExternalLink("edit-task")})),$(document).on("click","#edit-link-resources > ul > li > .edit-link-resource",(function(){var pageId=$(this).parent().data("pageid");$(this).parent().remove(),$("#edit-tree-selector").find("#check-"+pageId).attr("checked",!1),0==$("#edit-link-resources > ul").children().length&&$("#edit-link-resources > ul").remove()}))}}function updateDeadline(){$("#active-assignments-container, #overdue-assignments-container, #pending-assignments-container").on("click","a.change-deadline",(function(e){e.preventDefault();var taskId=$(this).closest("tr").data("task"),taskType=$(this).closest("tr").data("type"),row,task_deadline=$(".task-container").find("tr#task-"+taskId).find("td.deadline span.localdate").text(),check_task_deadline;$("#update-deadline-task-id").val(taskId),$("#update-deadline-task-type").val(taskType),$(".set-date").datepicker("remove"),setUpDatepicker(new Date(task_deadline)>new Date?new Date:new Date(task_deadline)),$("#edit-task-deadline").datepicker("update",task_deadline),$("#modal-change-deadline").modal("show")}))}{function updateRecipients(){$("#pending-assignments-container").on("click","a.update-recipients",(function(e){var taskId,combinedTaskId;e.preventDefault(),editRecipients($(this).closest("tr").data("task"),$(this).closest("tr").data("combined-task-id"))}))}function editRecipients(taskId,combinedTaskId){resetUpdateRecipientsModal(),$("#recipients-task-id").val(taskId),$("#recipients-combined-task-id").val(combinedTaskId);var row=$("#pending-assignments-container").find("tr#task-"+taskId);if($("#recipients-task-type").val(row.data("type")),"none"==row.find("a.show-students").data("groups")){var list=row.find("a.show-students").data("ids");for(i=0;i<list.length;i++)$('#modal-update-recipients .students-container input[value="'+list[i]+'"]').prop("checked",!0)}else{var groups=row.find("a.show-students").data("groups");for(i=0;i<groups.length;i++)$('#modal-update-recipients .groups-container input[value="'+groups[i]+'"]').prop("checked",!0)}updateRecipientsBtn(),$("#modal-update-recipients").modal("show")}function resetUpdateRecipientsModal(){$("#modal-update-recipients .students-container input:checked").prop("checked",!1),$("#modal-update-recipients .groups-container input:checked").prop("checked",!1),updateRecipientsBtn()}function updateRecipientsBtn(){var nMinStudents=0,taskType;nMinStudents="discussion"==$("#recipients-task-type").val()?1:0,$("#modal-update-recipients .groups-container").find("input:checked").length>0||$("#modal-update-recipients .students-container").find("input:checked").length>nMinStudents?$("#save-recipients").removeClass("disabled"):$("#save-recipients").addClass("disabled")}function selectUpdateRecipients(){$("#modal-update-recipients .students-container label").click((function(){$.when($("#modal-update-recipients .groups-container input:checked").prop("checked",!1)).then(updateRecipientsBtn())})),$("#modal-update-recipients .groups-container label").click((function(){$.when($("#modal-update-recipients .students-container input:checked").prop("checked",!1)).then(updateRecipientsBtn())}))}function actionUpdateRecipients(){$("#modal-update-recipients").on("click","#save-recipients",(function(e){e.preventDefault(),doUpdateRecipients()}))}function doUpdateRecipients(){var selectedRecipients=getSelectedRecipients("#modal-update-recipients"),page="pages/std-access/std-assignments.php?action=update-recipients",data={ticket:$("#ticket").val(),task_id:$("#recipients-task-id").val(),combined_task_id:$("#recipients-combined-task-id").val(),groups:selectedRecipients.groups,students:selectedRecipients.students,general_id:$("#general-id").val()};$.post(page,data,(function(response){"1"==response.success?($("#modal-update-recipients").modal("hide"),$(".std-assignment-send-msg").html(['<div class="alert alert-success">','<i class="fa fa-check-circle-o"></i> ',"<strong>Recipients successfully updated.</strong>","</div>"].join("")).show("fast").delay(5e3).hide("slow"),loadTasksList("general",null,["pending"])):"0"==response.success&&alert(response.msg)}),"json")}function sendAllStudentGrades(stdTaskIds){var tasks=[];stdTaskIds.forEach(id=>{tasks.push({id:id})});var page="pages/std-access/std-assignments.php?action=send-all-grades",data={ticket:$("#ticket").val(),general_id:$("#general-id").val(),"std-task-ids":tasks};$.post(page,data,(function(response){var sent;"1"==response.success?(JSON.parse(response.sent).forEach(taskId=>{$("#reports-panel #task-write-"+taskId).find("td.status > i").css("font-weight","normal").toggleClass("fa-floppy-o fa-paper-plane")}),$("#reports-panel").find("#send-std-grades").data("send","").attr("data-send","").addClass("disabled"),showSuccessMessage(".msg","All sent grades & comments successfully sent to students.")):alert(response.msg)}),"json")}function forgiveAllOverdues(stdTaskIds,taskId){var tasks=[];stdTaskIds.forEach(id=>{tasks.push({id:id})});var page="pages/std-access/std-assignments.php?action=forgive-all-overdues",data={ticket:$("#ticket").val(),general_id:$("#general-id").val(),"task-id":taskId,"std-task-ids":tasks};$.post(page,data,(function(response){"1"==response.success?(stdTaskIds.forEach(id=>{var row;$('li[data-std-task-id="'+id+'"]').closest("tr").find("td.score").html('<small class="gray" title="Not required">NR</small>')}),$("#reports-panel").find("#forgive-all-tasks").data("forgive","").attr("data-forgive","").addClass("disabled"),showSuccessMessage(".msg",response.forgiven+' task(s) successfully marked as "Not required"')):alert(response.msg)}),"json")}}{function validURL(str){var res=str.match(/(http(s)?:\/\/.)?(www\.)?[-a-zA-Z0-9@:%._\+~#=]{2,256}\.[a-z]{2,}\b([-a-zA-Z0-9@:%_\+.~#?&//=]*)/g),topLevelOrSecondLevelDomain=str.match(/[^.]*\.[^.]{2,}(?:\.[^.]{2,})?(?:[.:\/]|$)/gm);return null!==res&&null!=topLevelOrSecondLevelDomain}function setUpDatepicker(startDate=new Date){$(".set-date").datepicker({format:"dd M yyyy",autoclose:!0,clearBtn:!0,startDate:startDate}),$(".set-date").prev(".add-on").click((function(e){$(this).next(".set-date").datepicker().focus()}))}function cleanNodes(li){li.hasClass("not-for-students")&&0==li.find("li.for-students").length?li.remove():li.find("ul > li").length>0&&li.find("ul > li").each((function(){cleanNodes($(this))}))}function getRecursivelyResources(list){var idsList=[];return list.find("> li").each((function(){if($(this).find("> label > input").length>0&&$(this).find("> label > input").is(":checked")&&idsList.push($(this).find("> label > input").val()),$(this).find("> ul").length>0){var returnedList=getRecursivelyResources($(this).find("> ul"));idsList=$.merge(idsList,returnedList)}})),idsList}function addPagesLinks(){$(".checkpage").click((function(){$("#write-tab-link").parent().hasClass("active")&&addPagesLinksByType($(this),$("#link-resources"),"all-links","link-resource"),$("#discussion-tab-link").parent().hasClass("active")&&addPagesLinksByType($(this),$("#link-resources-discussion"),"all-links-discussion","link-resource-discussion"),$("#modal-edit-task-details").hasClass("in")&&addPagesLinksByType($(this),$("#edit-link-resources"),"edit-all-links","edit-link-resource")}))}function addPagesLinksByType(el,linkResources,elToAppendLinks,faIconClass){var pageId=el.val(),textLink=el.parent().find("span").text().trim();if(el.is(":checked")){var url=`https://www.student.${SITE_WEB}/${tibSitename}/page/${pageId}`;0==$("#"+elToAppendLinks).length&&linkResources.append(`<ul id="${elToAppendLinks}" style="margin-left: 0;"></ul>`);var link=[`<li id="pageid-${pageId}" data-pageid="${pageId}" style="list-style:none;">`,`<a href="${url}" target="_blank">${textLink}</a>`,`<i title="Remove student page" class="fa fa-trash-o colored ${faIconClass}" style="cursor: pointer;"></i> `,"</li>"].join("");$("#"+elToAppendLinks).append(link)}else $("#pageid-"+pageId).remove(),$("li#student-page, li#external-link").css("margin-top","0"),$("li#student-page-discussion, li#external-link-discussion").css("margin-top","0")}function showSuccessMessage(element,message){$(element).html(['<div class="alert alert-success" style="margin-bottom: 10px; margin-top: 10px;">','<i class="fa fa-check-circle-o"></i> ',"<strong>"+message+"</strong>","</div>"].join("")).show("fast").delay(5e3).hide("slow")}function hideSaveBtn(){$("#modal-task-status").html('<i class="fa fa-paper-plane" style="color: #128f76;"></i> Sent'),$("#modal-write-save").parent("div").removeClass("btn-group"),$("#modal-write-save").hide()}function appendLinks(el){var appendLinks="",links;return el.find("li").each((function(){var isExternalLink;if($(this).hasClass("external-links"))appendLinks+='<p><a target="_blank" href="'+$(this).text().trim()+'">'+$(this).text().trim()+"</a></p>";else{var url=$(this).find("a").attr("href"),textLink=$(this).find("a").text();appendLinks+='<p><a target="_blank" href="'+url+'">'+textLink+"</a></p>"}})),["\x3c!-- RESOURCES --\x3e",'<div class="resources">',appendLinks,"</div>","\x3c!-- END RESOURCES --\x3e"].join("")}function properlyURLLinks(url){return url=(url=null!=url.match(/(http(s)?:\/\/www.|www.|http(s)?:\/\/)/g)?url:"https://"+url).replace(/(http(s)?:\/\/www.|www.|http(s)?:\/\/)/g,"https://www.")}function disableEventsOnModalWrittenTaskReport(){$("#modal-write-details > .modal-body").addClass("stop-scrolling"),$("body").addClass("stop-scrolling"),$("#go-to-previous-task").attr("disabled",!0),$("#go-to-next-task").attr("disabled",!0)}function enableEventsOnModalWrittenTaskReport(){$("#modal-write-details > .modal-body").removeClass("stop-scrolling"),$("body").removeClass("stop-scrolling"),$("#go-to-previous-task").attr("disabled",!1),$("#go-to-next-task").attr("disabled",!1)}function getSelectedRecipients(place){var groups=[],students=[],selectedRecipients;return $(place).find(".students-container input").each((function(){$(this).is(":checked")&&students.push($(this).val())})),$(place).find(".groups-container input").each((function(){$(this).is(":checked")&&groups.push($(this).val())})),{groups:0===groups.length?null:groups,students:students}}function appendExternalLink(place,url=null){var places,selectors={"edit-task":{inputLink:"edit-link-instructions",linkResources:"edit-link-resources",allLinks:"edit-all-links",removeLink:"edit-link-resource"}}[place];if(null==url&&(url=$("#"+selectors.inputLink).val()),validURL(url=url.replace(/\s/g,""))){url=(url=null!=url.match(/(http(s)?:\/\/www.|www.|http(s)?:\/\/)/g)?url:"http://"+url).replace(/(http(s)?:\/\/www.|www.|http(s)?:\/\/)/g,"http://www.");var linkResources=$("#"+selectors.linkResources);0==$("#"+selectors.allLinks).length&&linkResources.append(`<ul id="${selectors.allLinks}" style="margin-left: 0;"></ul>`),$("#"+selectors.allLinks).append(`<li class="external-links" style="list-style:none;">                 <a href="${url}" target="_blank">${url}</a>                 <i title="Remove external link" class="fa fa-trash-o colored ${selectors.removeLink}" style="cursor: pointer;"></i>             </li>`),$("#"+selectors.inputLink).val("")}else $("#"+selectors.inputLink).val(""),alert("The URL that you are trying to put, is not valid.\n\nExample valid URL: "+SITE_URI)}function getGradeStatus(status){var wording,context="";switch(status){case"forgiven":wording="Not required",context="error";break;case"pending":wording="Not submitted",context="error";break;case"overdue":wording="Overdue",context="error"}return'<span class="not-completed text-'+context+'"><strong>'+wording+"</strong></span>"}function setUpModalSize(place){}function collapsibleTaskInstructions(){$(".task-instructions").on("click",".accordion-toggle",(function(){$(this).find("i.fa-caret-right").toggleClass("fa-rotate-90")}))}function resizeModalBodyOnScreenHeight(){}function addAssignmentPendingItem(item){for(var itemExists=!1,i=0;i<assignmentsNavigationItems.length;i++)if(navItem=assignmentsNavigationItems[i],navItem.name==item.name){navItem.count=item.count,itemExists=!0;break}if(!itemExists&&item.count>0&&assignmentsNavigationItems.push(item),assignmentsNavigationItems.length>1){for(var finalHTML='<p style="margin: 0;">',i=0;i<assignmentsNavigationItems.length;i++){navItem=assignmentsNavigationItems[i],navName="";var colorStyle=' style="color: inherit;"';"overdue"==navItem.name&&(colorStyle=' style="color: #933;"',navName="Overdue"),"pending"==navItem.name&&(navName="Draft"),"awaiting"==navItem.name&&(navName="Awaiting grade"),"completed"==navItem.name&&(navName="Completed"),"active"==navItem.name&&(navName="Active"),"forgiven"==navItem.name&&(navName="Not required"),finalHTML+='<a class="task-scroller" href="#'+navItem.name+'-assignments-container" style="margin: 0 5px;"> '+navName+": <strong "+colorStyle+">"+navItem.count+"</strong></a>"}finalHTML+="</p>",$("#tasks-navigator").html(finalHTML),$("a.task-scroller").click((function(e){e.preventDefault();var position=$($(this).attr("href")).prev().offset().top-6;$("body, html").animate({scrollTop:position},"fast")}))}}}